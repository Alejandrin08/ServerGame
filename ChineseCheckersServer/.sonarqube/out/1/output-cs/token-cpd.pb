Ù
oC:\Users\alexs\Desktop\JuegoTecno (2)\JuegoTecno\ChineseCheckers\ChineseCheckersLogicServer\Contracts\IBoard.cs
	namespace		 	&
ChineseCheckersLogicServer		
 $
.		$ %
	Contracts		% .
{		/ 0
[

 
ServiceContract

 
]

 
public 

	interface 
IBoard 
{ 
[ 	
OperationContract	 
] 
bool 
ValidateGame 
( 
string  
idRoom! '
)' (
;( )
[ 	
OperationContract	 
] 
bool 
ValidateBoard 
( 
string !
idRoom" (
)( )
;) *
} 
[ 
ServiceContract 
( 
CallbackContract %
=& '
typeof( .
(. /
ITurnCallback/ <
)< =
)= >
]> ?
public 

	interface 
ITurn 
{ 
[ 	
OperationContract	 
( 
IsOneWay #
=$ %
true& *
)* +
]+ ,
void 

SendToTurn 
( 
string 
idRoom %
)% &
;& '
[ 	
OperationContract	 
] 
void 
AddPlayerInGame 
( 
string #
gamertag$ ,
,, -
string. 4
idRoom5 ;
); <
;< =
[ 	
OperationContract	 
] 
void  
RemovePlayerFromGame !
(! "
string" (
gamertag) 1
,1 2
string3 9
idRoom: @
)@ A
;A B
[ 	
OperationContract	 
( 
IsOneWay #
=$ %
true& *
)* +
]+ ,
void 
UpdateBoard 
( 
Point 
marble %
,% &
Point' ,
position- 5
,5 6
string7 =
idRoom> D
)D E
;E F
[ 	
OperationContract	 
( 
IsOneWay #
=$ %
true& *
)* +
]+ ,
void 
WinningPlayer 
( 
string !
idRoom" (
,( )
string* 0
gamertag1 9
)9 :
;: ;
} 
[!! 
ServiceContract!! 
]!! 
public"" 

	interface"" 
ITurnCallback"" "
{""# $
[## 	
OperationContract##	 
]## 
void$$ 
GameTurn$$ 
($$ 
string$$ 
turn$$ !
,$$! "
int$$# &
type$$' +
)$$+ ,
;$$, -
[%% 	
OperationContract%%	 
]%% 
void&& 
UpdateBoardCallback&&  
(&&  !
Point&&! &
marble&&' -
,&&- .
Point&&/ 4
position&&5 =
)&&= >
;&&> ?
['' 	
OperationContract''	 
]'' 
void(( !
WinningPlayerCallback(( "
(((" #
string((# )
gamertag((* 2
)((2 3
;((3 4
})) 
}** º
tC:\Users\alexs\Desktop\JuegoTecno (2)\JuegoTecno\ChineseCheckers\ChineseCheckersLogicServer\Contracts\IFriendship.cs
	namespace		 	&
ChineseCheckersLogicServer		
 $
.		$ %
	Contracts		% .
{		/ 0
[

 
ServiceContract

 
]

 
public 

	interface 
IFriendship  
{! "
[ 	
OperationContract	 
] 
int 
AddFriendPlayer 
( 
FriendshipModel +
friendshipModel, ;
); <
;< =
[ 	
OperationContract	 
] 
int 
UpdateFriendPlayer 
( 
int "
idUser# )
,) *
int+ .
idFriend/ 7
,7 8
string9 ?
requestStatus@ M
)M N
;N O
[ 	
OperationContract	 
] 
int 
DeleteFriendPlayer 
( 
FriendshipModel .
friendshipModel/ >
)> ?
;? @
[ 	
OperationContract	 
] 
int !
ValidateFriendRequest !
(! "
int" %
idUser& ,
,, -
int. 1
idFriend2 :
,: ;
string< B
requestStatusC P
)P Q
;Q R
} 
[ 
ServiceContract 
( 
CallbackContract %
=& '
typeof( .
(. /&
IUserFriendRequestCallback/ I
)I J
)J K
]K L
public 

	interface 
IUserFriendRequest '
{( )
[ 	
OperationContract	 
( 
IsOneWay #
=$ %
true& *
)* +
]+ ,
void 
GetFriendRequest 
( 
int !
idUser" (
)( )
;) *
} 
[ 
ServiceContract 
] 
public 

	interface &
IUserFriendRequestCallback /
{0 1
[ 	
OperationContract	 
] 
void $
GetFriendRequestCallback %
(% &

Dictionary& 0
<0 1
string1 7
,7 8
(9 :
string: @
,@ A
stringB H
,H I
stringJ P
)P Q
>Q R
friendPlayerS _
)_ `
;` a
}   
}!! º
pC:\Users\alexs\Desktop\JuegoTecno (2)\JuegoTecno\ChineseCheckers\ChineseCheckersLogicServer\Contracts\IReport.cs
	namespace		 	&
ChineseCheckersLogicServer		
 $
.		$ %
	Contracts		% .
{		/ 0
[

 
ServiceContract

 
]

 
public 

	interface 
IReport 
{ 
[ 	
OperationContract	 
] 
int 
	AddReport 
( 
ReportModel !
reportModel" -
)- .
;. /
[ 	
OperationContract	 
] 
int 
UpdateReport 
( 
ReportModel $
reportModel% 0
)0 1
;1 2
[ 	
OperationContract	 
] 
int 
DeleteReport 
( 
int 
idUser #
)# $
;$ %
[ 	
OperationContract	 
] 
int 
GetNumReports 
( 
int 
idUser $
)$ %
;% &
[ 	
OperationContract	 
] 
DateTime 
GetDateReport 
( 
int "
idUser# )
)) *
;* +
[ 	
OperationContract	 
] 
bool 
IsBanned 
( 
int 
idUser  
)  !
;! "
[ 	
OperationContract	 
] 
bool 

IsReported 
( 
int 
idUser "
)" #
;# $
} 
} ³)
nC:\Users\alexs\Desktop\JuegoTecno (2)\JuegoTecno\ChineseCheckers\ChineseCheckersLogicServer\Contracts\IRoom.cs
	namespace		 	&
ChineseCheckersLogicServer		
 $
.		$ %
	Contracts		% .
{		/ 0
[ 
ServiceContract 
] 
public 

	interface 
IRoom 
{ 
[ 	
OperationContract	 
] 
string 

CreateRoom 
( 
string  
gamertag! )
)) *
;* +
[ 	
OperationContract	 
] 
string 

GenerateId 
( 
) 
; 
[ 	
OperationContract	 
] 
void 
RemovePlayer 
( 
string  
gamertag! )
,) *
string+ 1
idRoom2 8
)8 9
;9 :
[ 	
OperationContract	 
] 
bool 
ValidateRoom 
( 
string  
idRoom! '
)' (
;( )
[ 	
OperationContract	 
] 
bool 
ValidateBoardRoom 
( 
string %
idRoom& ,
), -
;- .
} 
[ 
ServiceContract 
( 
CallbackContract %
=& '
typeof( .
(. /
IMessageCallback/ ?
)? @
)@ A
]A B
public 

	interface 
IMessage 
{ 
[ 	
OperationContract	 
( 
IsOneWay #
=$ %
true& *
)* +
]+ ,
void 
SendMessage 
( 
string 
message  '
,' (
string) /
gamertag0 8
,8 9
string: @
idRoomA G
)G H
;H I
[ 	
OperationContract	 
] 
void 
	AddPlayer 
( 
string 
gamertag &
,& '
string( .
idRoom/ 5
)5 6
;6 7
} 
[!! 
ServiceContract!! 
]!! 
public"" 

	interface"" 
IMessageCallback"" %
{""& '
[## 	
OperationContract##	 
]## 
void$$ 
SendMessageCallback$$  
($$  !
string$$! '
message$$( /
,$$/ 0
string$$1 7
gamertag$$8 @
)$$@ A
;$$A B
}%% 
['' 
ServiceContract'' 
('' 
CallbackContract'' %
=''& '
typeof''( .
(''. / 
IPlayersRoomCallback''/ C
)''C D
)''D E
]''E F
public(( 

	interface(( 
IPlayersRoom(( !
{((" #
[)) 	
OperationContract))	 
()) 
IsOneWay)) #
=))$ %
true))& *
)))* +
]))+ ,
void** 
GetPlayersRoom** 
(** 
string** "
gamertag**# +
,**+ ,
string**- 3
idRoom**4 :
)**: ;
;**; <
[++ 	
OperationContract++	 
]++ 
void,, 
AddPlayerRoom,, 
(,, 
string,, !
gamertag,," *
,,,* +
string,,, 2
idRoom,,3 9
),,9 :
;,,: ;
[-- 	
OperationContract--	 
]-- 
void.. 
RemovePlayerRoom.. 
(.. 
string.. $
gamertag..% -
,..- .
string../ 5
idRoom..6 <
)..< =
;..= >
[// 	
OperationContract//	 
(// 
IsOneWay// #
=//$ %
true//& *
)//* +
]//+ ,
void00 
SendToBoard00 
(00 
string00 
idRoom00  &
)00& '
;00' (
[11 	
OperationContract11	 
(11 
IsOneWay11 #
=11$ %
true11& *
)11* +
]11+ ,
void22 
AssignColors22 
(22 
string22  
idRoom22! '
)22' (
;22( )
}33 
[55 
ServiceContract55 
]55 
public66 

	interface66  
IPlayersRoomCallback66 )
{66* +
[77 	
OperationContract77	 
]77 
void88 "
GetPlayersRoomCallback88 #
(88# $
List88$ (
<88( )
string88) /
>88/ 0
playersInRoom881 >
)88> ?
;88? @
[99 	
OperationContract99	 
]99 
void:: 
SendToBoardCallback::  
(::  !
)::! "
;::" #
[;; 	
OperationContract;;	 
];; 
void<<  
AssignColorsCallback<< !
(<<! "

Dictionary<<" ,
<<<, -
string<<- 3
,<<3 4
char<<5 9
><<9 :"
dictionaryPlayersColor<<; Q
)<<Q R
;<<R S
}== 
}>> Ê1
nC:\Users\alexs\Desktop\JuegoTecno (2)\JuegoTecno\ChineseCheckers\ChineseCheckersLogicServer\Contracts\IUser.cs
	namespace		 	&
ChineseCheckersLogicServer		
 $
.		$ %
	Contracts		% .
{		/ 0
[

 
ServiceContract

 
]

 
public 

	interface 
IUser 
{ 
[ 	
OperationContract	 
] 
int 
AddUserGame 
( 
	UserModel !
	userModel" +
)+ ,
;, -
[ 	
OperationContract	 
] 
int 
AddUserAccount 
( 
	UserModel $
	userModel% .
). /
;/ 0
[ 	
OperationContract	 
] 
int 
ValidateUser 
( 
	UserModel "
	userModel# ,
), -
;- .
[ 	
OperationContract	 
] 
string 
GetPlayerImage 
( 
string $
gamertag% -
)- .
;. /
[ 	
OperationContract	 
] 
int 
UpdateStatusPlayer 
( 
int "
idUser# )
,) *
bool+ /
status0 6
)6 7
;7 8
[ 	
OperationContract	 
] 
void 

LogoutUser 
( 
int 
idUser "
)" #
;# $
[ 	
OperationContract	 
] 
int 
ValidateEmail 
( 
	UserModel #
	userModel$ -
)- .
;. /
[ 	
OperationContract	 
] 
int 
ValidateGamertag 
( 
	UserModel &
	userModel' 0
)0 1
;1 2
[ 	
OperationContract	 
] 
int 
UpdatePassword 
( 
	UserModel $
	userModel% .
). /
;/ 0
[ 	
OperationContract	 
] 
	UserModel 
InfoUser 
( 
string !
gamertag" *
)* +
;+ ,
[   	
OperationContract  	 
]   
int!! 
UpdateInfoUser!! 
(!! 
	UserModel!! $
	usermodel!!% .
,!!. /
string!!0 6
gamertag!!7 ?
)!!? @
;!!@ A
["" 	
OperationContract""	 
]"" 
string## 
FindGamertag## 
(## 
string## "
currentGamertag### 2
,##2 3
string##4 :
friendGamertag##; I
)##I J
;##J K
[$$ 	
OperationContract$$	 
]$$ 
string%% 
GetEmail%% 
(%% 
string%% 
gamertag%% '
)%%' (
;%%( )
[&& 	
OperationContract&&	 
]&& 
int'' 
GetId'' 
('' 
string'' 
gamertag'' !
)''! "
;''" #
[(( 	
OperationContract((	 
](( 
int)) 
UpdateGamesWon)) 
()) 
int)) 
idUser)) %
)))% &
;))& '
[** 	
OperationContract**	 
]** 
int++ 
UpdateTotalGames++ 
(++ 
int++  
idUser++! '
)++' (
;++( )
[,, 	
OperationContract,,	 
],, 
int-- 
GetTotalGames-- 
(-- 
int-- 
idUser-- $
)--$ %
;--% &
[.. 	
OperationContract..	 
].. 
int// 
GetGamesWon// 
(// 
int// 
idUser// "
)//" #
;//# $
[00 	
OperationContract00	 
]00 

Dictionary11 
<11 
string11 
,11 
int11 
>11 
GetGames11  (
(11( )
)11) *
;11* +
}22 
[44 
ServiceContract44 
(44 
CallbackContract44 %
=44& '
typeof44( .
(44. /
IUserCallback44/ <
)44< =
)44= >
]44> ?
public55 

	interface55 
IUsersManager55 "
{55# $
[66 	
OperationContract66	 
(66 
IsOneWay66 #
=66$ %
true66& *
)66* +
]66+ ,
void77 

GetFriends77 
(77 
string77 
gamertag77 '
)77' (
;77( )
}88 
[:: 
ServiceContract:: 
]:: 
public;; 

	interface;; 
IUserCallback;; "
{;;# $
[<< 	
OperationContract<<	 
]<< 
void== 
GetFriendsCallback== 
(==  

Dictionary==  *
<==* +
string==+ 1
,==1 2
Tuple==3 8
<==8 9
string==9 ?
,==? @
bool==A E
>==E F
>==F G
stateFriend==H S
)==S T
;==T U
}>> 
[@@ 
ServiceContract@@ 
(@@ 
CallbackContract@@ %
=@@& '
typeof@@( .
(@@. / 
IUserSessionCallback@@/ C
)@@C D
)@@D E
]@@E F
publicAA 

	interfaceAA 
IUserSessionAA !
{AA" #
[BB 	
OperationContractBB	 
(BB 
IsOneWayBB #
=BB$ %
trueBB& *
)BB* +
]BB+ ,
voidCC 
GetSessionPlayerCC 
(CC 
intCC !
idUserCC" (
)CC( )
;CC) *
}DD 
[FF 
ServiceContractFF 
]FF 
publicGG 

	interfaceGG  
IUserSessionCallbackGG )
{GG* +
[HH 	
OperationContractHH	 
]HH 
voidII $
GetSessionPlayerCallbackII %
(II% &
boolII& *
sessionOpenedII+ 8
)II8 9
;II9 :
}JJ 
}KK ¨v
yC:\Users\alexs\Desktop\JuegoTecno (2)\JuegoTecno\ChineseCheckers\ChineseCheckersLogicServer\Controller\BoardController.cs
	namespace 	&
ChineseCheckersLogicServer
 $
.$ %

Controller% /
{0 1
public 

partial 
class 
ManagerController *
:+ ,
IBoard- 3
{4 5
public 
bool 
ValidateGame  
(  !
string! '
idRoom( .
). /
{0 1
try 
{ 
if 
( 
string 
. 
IsNullOrEmpty (
(( )
idRoom) /
)/ 0
)0 1
{2 3
return 
false  
;  !
} 
return   
_playersInGame   %
.  % &
ContainsKey  & 1
(  1 2
idRoom  2 8
)  8 9
;  9 :
}!! 
catch!! 
(!! "
CommunicationException!! +
ex!!, .
)!!. /
{!!0 1

MessageBox"" 
."" 
Show"" 
(""  
$"""  "
$str""" ?
{""? @
ex""@ B
.""B C
Message""C J
}""J K
"""K L
)""L M
;""M N
return## 
false## 
;## 
}$$ 
}%% 	
public-- 
bool-- 
ValidateBoard-- !
(--! "
string--" (
idRoom--) /
)--/ 0
{--1 2
try.. 
{.. 
const// 
int// 
MIN_PLAYERS_ROOM// *
=//+ ,
$num//- .
;//. /
return00 
_playersInGame00 %
.00% &
ContainsKey00& 1
(001 2
idRoom002 8
)008 9
&&00: <
_playersInGame00= K
[00K L
idRoom00L R
]00R S
.00S T
GamePlayers00T _
.00_ `
Count00` e
>00f g
MIN_PLAYERS_ROOM00h x
;00x y
}11 
catch11 
(11 "
CommunicationException11 +
ex11, .
)11. /
{110 1

MessageBox22 
.22 
Show22 
(22  
$"22  "
$str22" ?
{22? @
ex22@ B
.22B C
Message22C J
}22J K
"22K L
)22L M
;22M N
return33 
false33 
;33 
}44 
}55 	
}66 
public:: 

partial:: 
class:: 
ManagerController:: *
:::+ ,
ITurn::- 2
{::3 4
privateBB 
staticBB 

DictionaryBB !
<BB! "
stringBB" (
,BB( )
intBB* -
>BB- .
_turnTrackerBB/ ;
=BB< =
newBB> A

DictionaryBBB L
<BBL M
stringBBM S
,BBS T
intBBU X
>BBX Y
(BBY Z
)BBZ [
;BB[ \
privateCC 
staticCC 

DictionaryCC !
<CC! "
stringCC" (
,CC( )

BoardModelCC* 4
>CC4 5
_playersInGameCC6 D
=CCE F
newCCG J

DictionaryCCK U
<CCU V
stringCCV \
,CC\ ]

BoardModelCC^ h
>CCh i
(CCi j
)CCj k
;CCk l
publicEE 
voidEE 

SendToTurnEE 
(EE 
stringEE %
idRoomEE& ,
)EE, -
{EE. /
constFF 
intFF 
IS_TURNFF 
=FF 
$numFF  !
;FF! "
constGG 
intGG 
IS_NOT_TURNGG !
=GG" #
$numGG$ %
;GG% &
tryHH 
{HH 
ifII 
(II 
_playersInGameII "
.II" #
TryGetValueII# .
(II. /
idRoomII/ 5
,II5 6
outII7 :
varII; >
boardII? D
)IID E
)IIE F
{IIG H
ifJJ 
(JJ 
!JJ 
_turnTrackerJJ %
.JJ% &
ContainsKeyJJ& 1
(JJ1 2
idRoomJJ2 8
)JJ8 9
)JJ9 :
{JJ; <
_turnTrackerKK $
[KK$ %
idRoomKK% +
]KK+ ,
=KK- .
$numKK/ 0
;KK0 1
}LL 
intMM 
nextTurnMM  
=MM! "
_turnTrackerMM# /
[MM/ 0
idRoomMM0 6
]MM6 7
;MM7 8
varNN 
keysNN 
=NN 
boardNN $
.NN$ %
GamePlayersNN% 0
.NN0 1
KeysNN1 5
.NN5 6
ToListNN6 <
(NN< =
)NN= >
;NN> ?
ifOO 
(OO 
keysOO 
.OO 
CountOO "
>OO# $
$numOO% &
)OO& '
{OO( )
stringPP 
nextGamertagPP +
=PP, -
keysPP. 2
[PP2 3
nextTurnPP3 ;
%PP< =
keysPP> B
.PPB C
CountPPC H
]PPH I
;PPI J
_turnTrackerQQ $
[QQ$ %
idRoomQQ% +
]QQ+ ,
=QQ- .
(QQ/ 0
nextTurnQQ0 8
+QQ9 :
IS_TURNQQ; B
)QQB C
%QQD E
keysQQF J
.QQJ K
CountQQK P
;QQP Q
foreachRR 
(RR  !
varRR! $
gamePlayersRR% 0
inRR1 3
boardRR4 9
.RR9 :
GamePlayersRR: E
)RRE F
{RRG H
varSS 
gamertagSS  (
=SS) *
gamePlayersSS+ 6
.SS6 7
KeySS7 :
.SS: ;
ToStringSS; C
(SSC D
)SSD E
;SSE F
varTT 
contextTT  '
=TT( )
gamePlayersTT* 5
.TT5 6
ValueTT6 ;
;TT; <
varUU 
isTurnUU  &
=UU' (
gamertagUU) 1
==UU2 4
nextGamertagUU5 A
?UUB C
IS_TURNUUD K
:UUL M
IS_NOT_TURNUUN Y
;UUY Z
contextVV #
.VV# $
GameTurnVV$ ,
(VV, -
nextGamertagVV- 9
,VV9 :
isTurnVV; A
)VVA B
;VVB C
}WW 
}XX 
}YY 
}ZZ 
catchZZ 
(ZZ "
CommunicationExceptionZZ +
exZZ, .
)ZZ. /
{ZZ0 1

MessageBox[[ 
.[[ 
Show[[ 
([[  
$"[[  "
$str[[" O
{[[O P
ex[[P R
.[[R S
Message[[S Z
}[[Z [
"[[[ \
)[[\ ]
;[[] ^
}\\ 
}]] 	
publicff 
voidff 
UpdateBoardff 
(ff  
Pointff  %
marbleff& ,
,ff, -
Pointff. 3
positionff4 <
,ff< =
stringff> D
idRoomffE K
)ffK L
{ffM N
trygg 
{gg 
ifhh 
(hh 
_playersInGamehh "
.hh" #
ContainsKeyhh# .
(hh. /
idRoomhh/ 5
)hh5 6
)hh6 7
{hh8 9

BoardModelii 
boardii $
=ii% &
_playersInGameii' 5
[ii5 6
idRoomii6 <
]ii< =
;ii= >
ifjj 
(jj 
boardjj 
!=jj  
nulljj! %
&&jj& (
boardjj) .
.jj. /
GamePlayersjj/ :
!=jj; =
nulljj> B
)jjB C
{jjD E
foreachkk 
(kk  !
varkk! $
gamePlayerskk% 0
inkk1 3
boardkk4 9
.kk9 :
GamePlayerskk: E
.kkE F
ValueskkF L
)kkL M
{kkN O
gamePlayersll '
.ll' (
UpdateBoardCallbackll( ;
(ll; <
marblell< B
,llB C
positionllD L
)llL M
;llM N
}mm 
}nn 
}oo 
}pp 
catchpp 
(pp "
CommunicationExceptionpp +
expp, .
)pp. /
{pp0 1

MessageBoxqq 
.qq 
Showqq 
(qq  
$"qq  "
$strqq" B
{qqB C
exqqC E
.qqE F
MessageqqF M
}qqM N
"qqN O
)qqO P
;qqP Q
}rr 
}ss 	
public|| 
void|| 
AddPlayerInGame|| #
(||# $
string||$ *
gamertag||+ 3
,||3 4
string||5 ;
idRoom||< B
)||B C
{||D E
try}} 
{}} 
ITurnCallback~~ 
context~~ %
=~~& '
OperationContext~~( 8
.~~8 9
Current~~9 @
.~~@ A
GetCallbackChannel~~A S
<~~S T
ITurnCallback~~T a
>~~a b
(~~b c
)~~c d
;~~d e
if
 
(
 
_rooms
 
.
 
Contains
 #
(
# $
idRoom
$ *
)
* +
)
+ ,
{
- .
if
 
(
 
_playersInGame
 &
.
& '
ContainsKey
' 2
(
2 3
idRoom
3 9
)
9 :
)
: ;
{
< =

BoardModel
 "
board
# (
=
) *
_playersInGame
+ 9
[
9 :
idRoom
: @
]
@ A
;
A B
board
 
.
 
GamePlayers
 )
.
) *
Add
* -
(
- .
gamertag
. 6
,
6 7
context
8 ?
)
? @
;
@ A
}
 
else
 
{
 

BoardModel
 "
board
# (
=
) *
new
+ .

BoardModel
/ 9
{
: ;
IdRoom
 "
=
# $
idRoom
% +
}
 
;
 
board
 
.
 
GamePlayers
 )
.
) *
Add
* -
(
- .
gamertag
. 6
,
6 7
context
8 ?
)
? @
;
@ A
_playersInGame
 &
.
& '
Add
' *
(
* +
idRoom
+ 1
,
1 2
board
3 8
)
8 9
;
9 :
}
 
}
 
}
 
catch
 
(
 $
CommunicationException
 +
ex
, .
)
. /
{
0 1

MessageBox
 
.
 
Show
 
(
  
$"
  "
$str
" L
{
L M
ex
M O
.
O P
Message
P W
}
W X
"
X Y
)
Y Z
;
Z [
}
 
}
 	
public
 
void
 "
RemovePlayerFromGame
 (
(
( )
string
) /
gamertag
0 8
,
8 9
string
: @
idRoom
A G
)
G H
{
I J
const
 
int
 
MIN_PLAYERS_ROOM
 &
=
' (
$num
) *
;
* +
try
 
{
 
if
 
(
 
_playersInGame
 "
.
" #
ContainsKey
# .
(
. /
idRoom
/ 5
)
5 6
)
6 7
{
8 9

BoardModel
 
board
 $
=
% &
_playersInGame
' 5
[
5 6
idRoom
6 <
]
< =
;
= >
if
 
(
 
board
 
.
 
GamePlayers
 )
.
) *
Count
* /
>
0 1
MIN_PLAYERS_ROOM
2 B
)
B C
{
D E
board
 
.
 
GamePlayers
 )
.
) *
Remove
* 0
(
0 1
gamertag
1 9
)
9 :
;
: ;
}
   
else
   
{
   
board
¡¡ 
.
¡¡ 
GamePlayers
¡¡ )
.
¡¡) *
Remove
¡¡* 0
(
¡¡0 1
gamertag
¡¡1 9
)
¡¡9 :
;
¡¡: ;
_playersInGame
¢¢ &
.
¢¢& '
Remove
¢¢' -
(
¢¢- .
idRoom
¢¢. 4
)
¢¢4 5
;
¢¢5 6
}
££ 
}
¤¤ 
}
¥¥ 
catch
¥¥ 
(
¥¥ $
CommunicationException
¥¥ +
ex
¥¥, .
)
¥¥. /
{
¥¥0 1

MessageBox
¦¦ 
.
¦¦ 
Show
¦¦ 
(
¦¦  
$"
¦¦  "
$str
¦¦" M
{
¦¦M N
ex
¦¦N P
.
¦¦P Q
Message
¦¦Q X
}
¦¦X Y
"
¦¦Y Z
)
¦¦Z [
;
¦¦[ \
}
§§ 
}
¨¨ 	
public
±± 
void
±± 
WinningPlayer
±± !
(
±±! "
string
±±" (
idRoom
±±) /
,
±±/ 0
string
±±1 7
gamertag
±±8 @
)
±±@ A
{
±±B C
try
²² 
{
²² 
const
³³ 
int
³³ 
MIN_PLAYERS_ROOM
³³ *
=
³³+ ,
$num
³³- .
;
³³. /
string
´´ 
winningGamertag
´´ &
=
´´' (
gamertag
´´) 1
;
´´1 2
if
µµ 
(
µµ 
_playersInGame
µµ "
.
µµ" #
ContainsKey
µµ# .
(
µµ. /
idRoom
µµ/ 5
)
µµ5 6
)
µµ6 7
{
µµ8 9

BoardModel
·· 
board
·· $
=
··% &
_playersInGame
··' 5
[
··5 6
idRoom
··6 <
]
··< =
;
··= >
if
¸¸ 
(
¸¸ 
board
¸¸ 
.
¸¸ 
GamePlayers
¸¸ )
.
¸¸) *
Count
¸¸* /
==
¸¸0 2
MIN_PLAYERS_ROOM
¸¸3 C
)
¸¸C D
{
¸¸E F
winningGamertag
¹¹ '
=
¹¹( )
board
¹¹* /
.
¹¹/ 0
GamePlayers
¹¹0 ;
.
¹¹; <
Keys
¹¹< @
.
¹¹@ A
FirstOrDefault
¹¹A O
(
¹¹O P
)
¹¹P Q
?
¹¹Q R
.
¹¹R S
ToString
¹¹S [
(
¹¹[ \
)
¹¹\ ]
;
¹¹] ^
}
ºº 
foreach
»» 
(
»» 
var
»»  
gamePlayers
»»! ,
in
»»- /
board
»»0 5
.
»»5 6
GamePlayers
»»6 A
.
»»A B
Values
»»B H
)
»»H I
{
»»J K
gamePlayers
¼¼ #
.
¼¼# $#
WinningPlayerCallback
¼¼$ 9
(
¼¼9 :
winningGamertag
¼¼: I
)
¼¼I J
;
¼¼J K
}
½½ 
}
¾¾ 
}
¿¿ 
catch
¿¿ 
(
¿¿ $
CommunicationException
¿¿ +
ex
¿¿, .
)
¿¿. /
{
¿¿0 1

MessageBox
ÀÀ 
.
ÀÀ 
Show
ÀÀ 
(
ÀÀ  
$"
ÀÀ  "
$str
ÀÀ" A
{
ÀÀA B
ex
ÀÀB D
.
ÀÀD E
Message
ÀÀE L
}
ÀÀL M
"
ÀÀM N
)
ÀÀN O
;
ÀÀO P
}
ÁÁ 
}
ÂÂ 	
}
ÃÃ 
}ÄÄ o
~C:\Users\alexs\Desktop\JuegoTecno (2)\JuegoTecno\ChineseCheckers\ChineseCheckersLogicServer\Controller\FriendshipController.cs
	namespace 	&
ChineseCheckersLogicServer
 $
.$ %

Controller% /
{0 1
public 

partial 
class 
ManagerController *
:+ ,
IFriendship- 8
{9 :
public 
int 
AddFriendPlayer "
(" #
FriendshipModel# 2
friendshipModel3 B
)B C
{D E
try 
{ 
using 
( 
var 
context "
=# $
new% (#
ChineseCheckersEntities) @
(@ A
)A B
)B C
{D E
bool 
friendshipExists )
=* +
context, 3
.3 4
FriendPlayer4 @
.@ A
AnyA D
(D E
friendPlayerE Q
=>R T
friendPlayer $
.$ %
IdPlayer% -
==. 0
friendshipModel1 @
.@ A
IdUserA G
&&H J
friendPlayer   $
.  $ %
IdFriend  % -
==  . 0
friendshipModel  1 @
.  @ A
IdFriend  A I
&&  J L
friendPlayer!! $
.!!$ %
TypeNotification!!% 5
==!!6 8
friendshipModel!!9 H
.!!H I
TypeNotification!!I Y
)!!Y Z
;!!Z [
if## 
(## 
!## 
friendshipExists## )
)##) *
{##+ ,
var$$ 
friendPlayer$$ (
=$$) *
new$$+ .
FriendPlayer$$/ ;
{$$< =
IdPlayer%% $
=%%% &
friendshipModel%%' 6
.%%6 7
IdUser%%7 =
,%%= >
IdFriend&& $
=&&% &
friendshipModel&&' 6
.&&6 7
IdFriend&&7 ?
,&&? @
RequestStatus'' )
=''* +
friendshipModel'', ;
.''; <
RequestStatus''< I
,''I J
TypeNotification(( ,
=((- .
friendshipModel((/ >
.((> ?
TypeNotification((? O
,((O P
})) 
;)) 
SingletonClass** &
.**& '
Instance**' /
.**/ 0
IdRoom**0 6
=**7 8
friendshipModel**9 H
.**H I
IdRoom**I O
;**O P
context++ 
.++  
FriendPlayer++  ,
.++, -
Add++- 0
(++0 1
friendPlayer++1 =
)++= >
;++> ?
return,, 
context,, &
.,,& '
SaveChanges,,' 2
(,,2 3
),,3 4
;,,4 5
}-- 
else-- 
{-- 
return.. 
-..  
$num..  !
;..! "
}// 
}00 
}11 
catch11 
(11 
EntityException11 $
ex11% '
)11' (
{11) *

MessageBox22 
.22 
Show22 
(22  
$"22  "
$str22" @
{22@ A
ex22A C
.22C D
Message22D K
}22K L
"22L M
)22M N
;22N O
return33 
-33 
$num33 
;33 
}44 
}55 	
public?? 
int?? 
UpdateFriendPlayer?? %
(??% &
int??& )
idUser??* 0
,??0 1
int??2 5
idFriend??6 >
,??> ?
string??@ F
requestStatus??G T
)??T U
{??V W
try@@ 
{@@ 
usingAA 
(AA 
varAA 
contextAA "
=AA# $
newAA% (#
ChineseCheckersEntitiesAA) @
(AA@ A
)AAA B
)AAB C
{AAD E
varBB 
friendPlayerBB $
=BB% &
contextBB' .
.BB. /
FriendPlayerBB/ ;
.CC 
FirstOrDefaultCC '
(CC' (
friendCC( .
=>CC/ 1
friendDD "
.DD" #
IdPlayerDD# +
==DD, .
idUserDD/ 5
&&DD6 8
friendDD9 ?
.DD? @
IdFriendDD@ H
==DDI K
idFriendDDL T
)DDT U
;DDU V
ifFF 
(FF 
friendPlayerFF $
!=FF% '
nullFF( ,
)FF, -
{FF. /
friendPlayerGG $
.GG$ %
RequestStatusGG% 2
=GG3 4
requestStatusGG5 B
;GGB C
returnHH 
contextHH &
.HH& '
SaveChangesHH' 2
(HH2 3
)HH3 4
;HH4 5
}II 
elseII 
{II 
returnJJ 
-JJ  
$numJJ  !
;JJ! "
}KK 
}LL 
}MM 
catchMM 
(MM 
EntityExceptionMM $
exMM% '
)MM' (
{MM) *

MessageBoxNN 
.NN 
ShowNN 
(NN  
$"NN  "
$strNN" C
{NNC D
exNND F
.NNF G
MessageNNG N
}NNN O
"NNO P
)NNP Q
;NNQ R
returnOO 
-OO 
$numOO 
;OO 
}PP 
}QQ 	
publicYY 
intYY 
DeleteFriendPlayerYY %
(YY% &
FriendshipModelYY& 5
friendshipModelYY6 E
)YYE F
{YYG H
tryZZ 
{ZZ 
using[[ 
([[ 
var[[ 
context[[ "
=[[# $
new[[% (#
ChineseCheckersEntities[[) @
([[@ A
)[[A B
)[[B C
{[[D E
var\\ 
friendPlayer\\ $
=\\% &
context\\' .
.\\. /
FriendPlayer\\/ ;
.]] 
FirstOrDefault]] '
(]]' (
friend]]( .
=>]]/ 1
friend^^ "
.^^" #
IdPlayer^^# +
==^^, .
friendshipModel^^/ >
.^^> ?
IdUser^^? E
&&^^F H
friend__ "
.__" #
IdFriend__# +
==__, .
friendshipModel__/ >
.__> ?
IdFriend__? G
&&__H J
friend`` "
.``" #
TypeNotification``# 3
==``4 6
friendshipModel``7 F
.``F G
TypeNotification``G W
)``W X
;``X Y
ifbb 
(bb 
friendPlayerbb $
!=bb% '
nullbb( ,
)bb, -
{bb. /
contextcc 
.cc  
FriendPlayercc  ,
.cc, -
Removecc- 3
(cc3 4
friendPlayercc4 @
)cc@ A
;ccA B
returndd 
contextdd &
.dd& '
SaveChangesdd' 2
(dd2 3
)dd3 4
;dd4 5
}ee 
elseee 
{ee 
returnff 
-ff  
$numff  !
;ff! "
}gg 
}hh 
}ii 
catchii 
(ii 
EntityExceptionii $
exii% '
)ii' (
{ii) *

MessageBoxjj 
.jj 
Showjj 
(jj  
$"jj  "
$strjj" A
{jjA B
exjjB D
.jjD E
MessagejjE L
}jjL M
"jjM N
)jjN O
;jjO P
returnkk 
-kk 
$numkk 
;kk 
}ll 
}mm 	
privateww 
staticww 
readonlyww 
objectww  &
validationLockww' 5
=ww6 7
newww8 ;
objectww< B
(wwB C
)wwC D
;wwD E
publicxx 
intxx !
ValidateFriendRequestxx (
(xx( )
intxx) ,
idUserxx- 3
,xx3 4
intxx5 8
idFriendxx9 A
,xxA B
stringxxC I
requestStatusxxJ W
)xxW X
{xxY Z
tryyy 
{yy 
lockzz 
(zz 
validationLockzz $
)zz$ %
{zz& '
using{{ 
({{ 
var{{ 
context{{ &
={{' (
new{{) ,#
ChineseCheckersEntities{{- D
({{D E
){{E F
){{F G
{{{H I
bool|| 
isValidatedRequest|| /
=||0 1
context||2 9
.||9 :
FriendPlayer||: F
.}} 
Any}}  
(}}  !

userFriend}}! +
=>}}, .

userFriend}}/ 9
.}}9 :
IdPlayer}}: B
==}}C E
idUser}}F L
&&}}M O

userFriend~~/ 9
.~~9 :
IdFriend~~: B
==~~C E
idFriend~~F N
&&~~O Q

userFriend/ 9
.9 :
RequestStatus: G
==H J
requestStatusK X
)X Y
;Y Z
return
  
isValidatedRequest
 1
?
2 3
$num
4 5
:
6 7
-
8 9
$num
9 :
;
: ;
}
 
}
 
}
 
catch
 
(
 
EntityException
 $
ex
% '
)
' (
{
) *

MessageBox
 
.
 
Show
 
(
  
$"
  "
$str
" M
{
M N
ex
N P
.
P Q
Message
Q X
}
X Y
"
Y Z
)
Z [
;
[ \
return
 
-
 
$num
 
;
 
}
 
}
 	
}
 
public
 

partial
 
class
 
ManagerController
 *
:
+ , 
IUserFriendRequest
- ?
{
@ A
public
 
void
 
GetFriendRequest
 $
(
$ %
int
% (
idUser
) /
)
/ 0
{
1 2

Dictionary
 
<
 
string
 
,
 
(
  
string
  &
,
& '
string
( .
,
. /
string
0 6
)
6 7
>
7 8
friendsDictionary
9 J
=
K L
new
M P

Dictionary
Q [
<
[ \
string
\ b
,
b c
(
d e
string
e k
,
k l
string
m s
,
s t
string
u {
)
{ |
>
| }
(
} ~
)
~ 
; 
try
 
{
 
const
 
string
 
FRIEND_REQUEST
 +
=
, -
$str
. 7
;
7 8
using
 
(
 
var
 
context
 "
=
# $
new
% (%
ChineseCheckersEntities
) @
(
@ A
)
A B
)
B C
{
D E
var
 

friendData
 "
=
# $
(
% &
from
& *
friend
+ 1
in
2 4
context
5 <
.
< =
FriendPlayer
= I
join
& *
user
+ /
in
0 2
context
3 :
.
: ;
UserAccount
; F
on
G I
friend
J P
.
P Q
IdPlayer
Q Y
equals
Z `
user
a e
.
e f
Id
f h
where
& +
friend
, 2
.
2 3
RequestStatus
3 @
==
A C
FRIEND_REQUEST
D R
&&
S U
friend
V \
.
\ ]
IdFriend
] e
==
f h
idUser
i o
select
& ,
new
- 0
{
1 2
user
* .
.
. /
Id
/ 1
,
1 2
Gamertag
* 2
=
3 4
user
5 9
.
9 :
GamertagUser
: F
,
F G
user
* .
.
. /
ImageProfile
/ ;
,
; <
friend
* 0
.
0 1
TypeNotification
1 A
,
A B
SingletonClass
  * 8
.
  8 9
Instance
  9 A
.
  A B
IdRoom
  B H
}
¡¡& '
)
¡¡' (
.
¡¡( )
ToList
¡¡) /
(
¡¡/ 0
)
¡¡0 1
;
¡¡1 2
foreach
¢¢ 
(
¢¢ 
var
¢¢  
friend
¢¢! '
in
¢¢( *

friendData
¢¢+ 5
)
¢¢5 6
{
¢¢7 8
friendsDictionary
££ )
[
££) *
friend
££* 0
.
££0 1
Gamertag
££1 9
]
££9 :
=
££; <
(
££= >
friend
££> D
.
££D E
ImageProfile
££E Q
,
££Q R
friend
££S Y
.
££Y Z
TypeNotification
££Z j
,
££j k
friend
££l r
.
££r s
IdRoom
££s y
)
££y z
;
££z {
}
¤¤ (
IUserFriendRequestCallback
¥¥ .
callback
¥¥/ 7
=
¥¥8 9
OperationContext
¥¥: J
.
¥¥J K
Current
¥¥K R
.
¥¥R S 
GetCallbackChannel
¥¥S e
<
¥¥e f)
IUserFriendRequestCallback¥¥f 
>¥¥ 
(¥¥ 
)¥¥ 
;¥¥ 
callback
¦¦ 
.
¦¦ &
GetFriendRequestCallback
¦¦ 5
(
¦¦5 6
friendsDictionary
¦¦6 G
)
¦¦G H
;
¦¦H I
}
§§ 
}
¨¨ 
catch
¨¨ 
(
¨¨ $
CommunicationException
¨¨ +
ex
¨¨, .
)
¨¨. /
{
¨¨0 1

MessageBox
©© 
.
©© 
Show
©© 
(
©©  
$"
©©  "
$str
©©" G
{
©©G H
ex
©©H J
.
©©J K
Message
©©K R
}
©©R S
"
©©S T
)
©©T U
;
©©U V
}
ªª 
catch
ªª 
(
ªª 
EntityException
ªª $
ex
ªª% '
)
ªª' (
{
ªª) *

MessageBox
«« 
.
«« 
Show
«« 
(
««  
$"
««  "
$str
««" G
{
««G H
ex
««H J
.
««J K
Message
««K R
}
««R S
"
««S T
)
««T U
;
««U V
}
¬¬ 
}
­­ 	
}
®® 
}¯¯ ±j
zC:\Users\alexs\Desktop\JuegoTecno (2)\JuegoTecno\ChineseCheckers\ChineseCheckersLogicServer\Controller\ReportController.cs
	namespace 	&
ChineseCheckersLogicServer
 $
.$ %

Controller% /
{0 1
public 

partial 
class 
ManagerController *
:+ ,
IReport- 4
{5 6
public 
int 
	AddReport 
( 
ReportModel (
reportModel) 4
)4 5
{6 7
try 
{ 
const 
int 
INITIAL_COUNTER )
=* +
$num, -
;- .
using 
( 
var 
context "
=# $
new% (#
ChineseCheckersEntities) @
(@ A
)A B
)B C
{D E
var 

reportUser "
=# $
new% (
Reports) 0
{1 2
IdUser   
=    
reportModel  ! ,
.  , -
IdUser  - 3
,  3 4
Counter!! 
=!!  !
INITIAL_COUNTER!!" 1
,!!1 2
Reason"" 
=""  
reportModel""! ,
."", -
Reason""- 3
,""3 4
DateCurrent## #
=##$ %
reportModel##& 1
.##1 2
CurrentDate##2 =
,##= >

DateFinish$$ "
=$$# $
reportModel$$% 0
.$$0 1
EndDate$$1 8
,$$8 9
}%% 
;%% 
context&& 
.&& 
Reports&& #
.&&# $
Add&&$ '
(&&' (

reportUser&&( 2
)&&2 3
;&&3 4
return'' 
context'' "
.''" #
SaveChanges''# .
(''. /
)''/ 0
;''0 1
}(( 
})) 
catch)) 
()) 
EntityException)) $
ex))% '
)))' (
{))) *

MessageBox** 
.** 
Show** 
(**  
$"**  "
$str**" ?
{**? @
ex**@ B
.**B C
Message**C J
}**J K
"**K L
)**L M
;**M N
return++ 
-++ 
$num++ 
;++ 
},, 
}-- 	
public66 
int66 
UpdateReport66 
(66  
ReportModel66  +
reportModel66, 7
)667 8
{669 :
try77 
{77 
using88 
(88 
var88 
context88 "
=88# $
new88% (#
ChineseCheckersEntities88) @
(88@ A
)88A B
)88B C
{88D E
var99 

userReport99 "
=99# $
context99% ,
.99, -
Reports99- 4
.:: 
Where:: 
(:: 
user:: #
=>::$ &
user::' +
.::+ ,
IdUser::, 2
==::3 5
reportModel::6 A
.::A B
IdUser::B H
)::H I
.;; 
FirstOrDefault;; '
(;;' (
);;( )
;;;) *
if<< 
(<< 

userReport<< "
!=<<# %
null<<& *
)<<* +
{<<, -

userReport== "
.==" #
Counter==# *
++==* ,
;==, -

userReport>> "
.>>" #
Reason>># )
=>>* +
reportModel>>, 7
.>>7 8
Reason>>8 >
;>>> ?

userReport?? "
.??" #
DateCurrent??# .
=??/ 0
reportModel??1 <
.??< =
CurrentDate??= H
;??H I

userReport@@ "
.@@" #

DateFinish@@# -
=@@. /
reportModel@@0 ;
.@@; <
EndDate@@< C
;@@C D
}AA 
returnBB 
contextBB "
.BB" #
SaveChangesBB# .
(BB. /
)BB/ 0
;BB0 1
}CC 
}DD 
catchDD 
(DD 
EntityExceptionDD $
exDD% '
)DD' (
{DD) *

MessageBoxEE 
.EE 
ShowEE 
(EE  
$"EE  "
$strEE" B
{EEB C
exEEC E
.EEE F
MessageEEF M
}EEM N
"EEN O
)EEO P
;EEP Q
returnFF 
-FF 
$numFF 
;FF 
}GG 
}HH 	
publicPP 
intPP 
DeleteReportPP 
(PP  
intPP  #
idUserPP$ *
)PP* +
{PP, -
tryQQ 
{QQ 
usingRR 
(RR 
varRR 
contextRR "
=RR# $
newRR% (#
ChineseCheckersEntitiesRR) @
(RR@ A
)RRA B
)RRB C
{RRD E
varSS 
reportToDeleteSS &
=SS' (
contextSS) 0
.SS0 1
ReportsSS1 8
.SS8 9
FirstOrDefaultSS9 G
(SSG H
reportSSH N
=>SSO Q
reportSSR X
.SSX Y
IdUserSSY _
==SS` b
idUserSSc i
)SSi j
;SSj k
ifTT 
(TT 
reportToDeleteTT &
!=TT' )
nullTT* .
)TT. /
{TT0 1
contextUU 
.UU  
ReportsUU  '
.UU' (
RemoveUU( .
(UU. /
reportToDeleteUU/ =
)UU= >
;UU> ?
}VV 
returnWW 
contextWW "
.WW" #
SaveChangesWW# .
(WW. /
)WW/ 0
;WW0 1
}XX 
}YY 
catchYY 
(YY 
EntityExceptionYY $
exYY% '
)YY' (
{YY) *

MessageBoxZZ 
.ZZ 
ShowZZ 
(ZZ  
$"ZZ  "
$strZZ" @
{ZZ@ A
exZZA C
.ZZC D
MessageZZD K
}ZZK L
"ZZL M
)ZZM N
;ZZN O
return[[ 
-[[ 
$num[[ 
;[[ 
}\\ 
}]] 	
publicee 
intee 
GetNumReportsee  
(ee  !
intee! $
idUseree% +
)ee+ ,
{ee- .
tryff 
{ff 
intgg 

numReportsgg 
=gg  
-gg! "
$numgg" #
;gg# $
usinghh 
(hh 
varhh 
contexthh "
=hh# $
newhh% (#
ChineseCheckersEntitieshh) @
(hh@ A
)hhA B
)hhB C
{hhD E
varii 
counterValuesii %
=ii& '
contextii( /
.ii/ 0
Reportsii0 7
.jj 
FirstOrDefaultjj '
(jj' (
counterjj( /
=>jj0 2
counterjj3 :
.jj: ;
IdUserjj; A
==jjB D
idUserjjE K
)jjK L
;jjL M
ifkk 
(kk 
counterValueskk %
!=kk& (
nullkk) -
)kk- .
{kk/ 0

numReportsll "
=ll# $
(ll% &
intll& )
)ll) *
counterValuesll* 7
.ll7 8
Counterll8 ?
;ll? @
}mm 
returnnn 

numReportsnn %
;nn% &
}oo 
}pp 
catchpp 
(pp 
EntityExceptionpp $
expp% '
)pp' (
{pp) *

MessageBoxqq 
.qq 
Showqq 
(qq  
$"qq  "
$strqq" L
{qqL M
exqqM O
.qqO P
MessageqqP W
}qqW X
"qqX Y
)qqY Z
;qqZ [
returnrr 
-rr 
$numrr 
;rr 
}ss 
}tt 	
public|| 
DateTime|| 
GetDateReport|| %
(||% &
int||& )
idUser||* 0
)||0 1
{||2 3
try}} 
{}} 
DateTime~~ 
dateTime~~ !
=~~" #
DateTime~~$ ,
.~~, -
Now~~- 0
;~~0 1
using 
( 
var 
context "
=# $
new% (#
ChineseCheckersEntities) @
(@ A
)A B
)B C
{D E
var
 

dateValues
 "
=
# $
context
% ,
.
, -
Reports
- 4
.
 
FirstOrDefault
 '
(
' (
date
( ,
=>
- /
date
0 4
.
4 5
IdUser
5 ;
==
< >
idUser
? E
)
E F
;
F G
if
 
(
 

dateValues
 "
!=
# %
null
& *
)
* +
{
, -
dateTime
  
=
! "
(
# $
DateTime
$ ,
)
, -

dateValues
- 7
.
7 8

DateFinish
8 B
;
B C
}
 
return
 
dateTime
 #
;
# $
}
 
}
 
catch
 
(
 
EntityException
 $
ex
% '
)
' (
{
) *

MessageBox
 
.
 
Show
 
(
  
$"
  "
$str
" H
{
H I
ex
I K
.
K L
Message
L S
}
S T
"
T U
)
U V
;
V W
return
 
DateTime
 
.
  
Now
  #
;
# $
}
 
}
 	
public
 
bool
 

IsReported
 
(
 
int
 "
idUser
# )
)
) *
{
+ ,
try
 
{
 
bool
 

isReported
 
=
  !
true
" &
;
& '
DateTime
 
dateTime
 !
;
! "
using
 
(
 
var
 
context
 "
=
# $
new
% (%
ChineseCheckersEntities
) @
(
@ A
)
A B
)
B C
{
D E
var
 

dateValues
 "
=
# $
context
% ,
.
, -
Reports
- 4
.
 
FirstOrDefault
 '
(
' (
date
( ,
=>
- /
date
0 4
.
4 5
IdUser
5 ;
==
< >
idUser
? E
)
E F
;
F G
if
 
(
 

dateValues
 "
!=
# %
null
& *
)
* +
{
, -
dateTime
  
=
! "
(
# $
DateTime
$ ,
)
, -

dateValues
- 7
.
7 8

DateFinish
8 B
;
B C
if
 
(
 
dateTime
 $
>
% &
DateTime
' /
.
/ 0
Now
0 3
)
3 4
{
5 6

isReported
 &
=
' (
false
) .
;
. /
}
 
}
 
return
   

isReported
   %
;
  % &
}
¡¡ 
}
¢¢ 
catch
¢¢ 
(
¢¢ 
EntityException
¢¢ $
ex
¢¢% '
)
¢¢' (
{
¢¢) *

MessageBox
££ 
.
££ 
Show
££ 
(
££  
$"
££  "
$str
££" ?
{
££? @
ex
££@ B
.
££B C
Message
££C J
}
££J K
"
££K L
)
££L M
;
££M N
return
¤¤ 
false
¤¤ 
;
¤¤ 
}
¥¥ 
}
¦¦ 	
public
®® 
bool
®® 
IsBanned
®® 
(
®® 
int
®®  
idUser
®®! '
)
®®' (
{
®®) *
try
¯¯ 
{
¯¯ 
const
°° 
string
°° 
BANNED
°° #
=
°°$ %
$str
°°& )
;
°°) *
bool
±± 
isBanned
±± 
=
±± 
false
±±  %
;
±±% &
using
²² 
(
²² 
var
²² 
context
²² "
=
²²# $
new
²²% (%
ChineseCheckersEntities
²²) @
(
²²@ A
)
²²A B
)
²²B C
{
²²D E
var
³³ 

userBanned
³³ "
=
³³# $
context
³³% ,
.
³³, -
User
³³- 1
.
´´ 
FirstOrDefault
´´ '
(
´´' (
banned
´´( .
=>
´´/ 1
banned
´´2 8
.
´´8 9
Id
´´9 ;
==
´´< >
idUser
´´? E
)
´´E F
;
´´F G
if
µµ 
(
µµ 

userBanned
µµ "
!=
µµ# %
null
µµ& *
&&
µµ+ -

userBanned
µµ. 8
.
µµ8 9
PlayerStatus
µµ9 E
.
µµE F
Equals
µµF L
(
µµL M
BANNED
µµM S
)
µµS T
)
µµT U
{
µµV W
isBanned
¶¶  
=
¶¶! "
true
¶¶# '
;
¶¶' (
}
·· 
return
¸¸ 
isBanned
¸¸ #
;
¸¸# $
}
¹¹ 
}
ºº 
catch
ºº 
(
ºº 
EntityException
ºº $
ex
ºº% '
)
ºº' (
{
ºº) *

MessageBox
»» 
.
»» 
Show
»» 
(
»»  
$"
»»  "
$str
»»" =
{
»»= >
ex
»»> @
.
»»@ A
Message
»»A H
}
»»H I
"
»»I J
)
»»J K
;
»»K L
return
¼¼ 
false
¼¼ 
;
¼¼ 
}
½½ 
}
¾¾ 	
}
¿¿ 
}ÀÀ ßÝ
xC:\Users\alexs\Desktop\JuegoTecno (2)\JuegoTecno\ChineseCheckers\ChineseCheckersLogicServer\Controller\RoomController.cs
	namespace 	&
ChineseCheckersLogicServer
 $
.$ %

Controller% /
{0 1
public 

partial 
class 
ManagerController *
:+ ,
IRoom- 2
{3 4
private 
static 
readonly 
List  $
<$ %
string% +
>+ ,
_rooms- 3
=4 5
new6 9
List: >
<> ?
string? E
>E F
(F G
)G H
;H I
public 
string 

CreateRoom  
(  !
string! '
gamertag( 0
)0 1
{2 3
try 
{ 
string 
idRoom 
; 
do 
{ 
idRoom   
=   

GenerateId   '
(  ' (
)  ( )
;  ) *
}!! 
while!! 
(!! 
_rooms!! 
.!!  
Contains!!  (
(!!( )
idRoom!!) /
)!!/ 0
)!!0 1
;!!1 2
_rooms"" 
."" 
Add"" 
("" 
idRoom"" !
)""! "
;""" #
return## 
idRoom## 
;## 
}$$ 
catch$$ 
($$ "
CommunicationException$$ +
ex$$, .
)$$. /
{$$0 1

MessageBox%% 
.%% 
Show%% 
(%%  
$"%%  "
$str%%" :
{%%: ;
ex%%; =
.%%= >
Message%%> E
}%%E F
"%%F G
)%%G H
;%%H I
return&& 
null&& 
;&& 
}'' 
}(( 	
public// 
string// 

GenerateId//  
(//  !
)//! "
{//# $
try00 
{00 
const11 
string11 

CHARACTERS11 '
=11( )
$str11* 6
;116 7
const22 
int22 
MAX_PLAYERS22 %
=22& '
$num22( )
;22) *
StringBuilder33 
id33  
=33! "
new33# &
StringBuilder33' 4
(334 5
)335 6
;336 7
using55 
(55 
var55 
randomGenerator55 *
=55+ ,!
RandomNumberGenerator55- B
.55B C
Create55C I
(55I J
)55J K
)55K L
{55M N
byte66 
[66 
]66 
data66 
=66  !
new66" %
byte66& *
[66* +
MAX_PLAYERS66+ 6
]666 7
;667 8
randomGenerator88 #
.88# $
GetBytes88$ ,
(88, -
data88- 1
)881 2
;882 3
for:: 
(:: 
int:: 
i:: 
=::  
$num::! "
;::" #
i::$ %
<::& '
MAX_PLAYERS::( 3
;::3 4
i::5 6
++::6 8
)::8 9
{::: ;
int;; 
index;; !
=;;" #
data;;$ (
[;;( )
i;;) *
];;* +
%;;, -

CHARACTERS;;. 8
.;;8 9
Length;;9 ?
;;;? @
id<< 
.<< 
Append<< !
(<<! "

CHARACTERS<<" ,
[<<, -
index<<- 2
]<<2 3
)<<3 4
;<<4 5
}== 
}>> 
return?? 
id?? 
.?? 
ToString?? "
(??" #
)??# $
;??$ %
}@@ 
catch@@ 
(@@ "
CommunicationException@@ +
ex@@, .
)@@. /
{@@0 1

MessageBoxAA 
.AA 
ShowAA 
(AA  
$"AA  "
$strAA" :
{AA: ;
exAA; =
.AA= >
MessageAA> E
}AAE F
"AAF G
)AAG H
;AAH I
returnBB 
nullBB 
;BB 
}CC 
}DD 	
publicLL 
voidLL 
RemovePlayerLL  
(LL  !
stringLL! '
gamertagLL( 0
,LL0 1
stringLL2 8
idRoomLL9 ?
)LL? @
{LLA B
tryMM 
{MM 
constNN 
intNN 
MIN_PLAYERSNN %
=NN& '
$numNN( )
;NN) *
ifOO 
(OO 
_playersInRoomOO "
.OO" #
ContainsKeyOO# .
(OO. /
idRoomOO/ 5
)OO5 6
)OO6 7
{OO8 9
	RoomModelPP 
roomPP "
=PP# $
_playersInRoomPP% 3
[PP3 4
idRoomPP4 :
]PP: ;
;PP; <
ifRR 
(RR 
roomRR 
.RR 
PlayersRR $
.RR$ %
CountRR% *
>RR+ ,
MIN_PLAYERSRR- 8
)RR8 9
{RR: ;
roomSS 
.SS 
PlayersSS $
.SS$ %
RemoveSS% +
(SS+ ,
gamertagSS, 4
)SS4 5
;SS5 6
}UU 
elseUU 
{UU 
roomVV 
.VV 
PlayersVV $
.VV$ %
RemoveVV% +
(VV+ ,
gamertagVV, 4
)VV4 5
;VV5 6
_playersInRoomWW &
.WW& '
RemoveWW' -
(WW- .
idRoomWW. 4
)WW4 5
;WW5 6
_roomsXX 
.XX 
RemoveXX %
(XX% &
idRoomXX& ,
)XX, -
;XX- .
}YY 
}ZZ 
}[[ 
catch[[ 
([[ "
CommunicationException[[ +
ex[[, .
)[[. /
{[[0 1

MessageBox\\ 
.\\ 
Show\\ 
(\\  
$"\\  "
$str\\" I
{\\I J
ex\\J L
.\\L M
Message\\M T
}\\T U
"\\U V
)\\V W
;\\W X
}]] 
}^^ 	
publicff 
boolff 
ValidateRoomff  
(ff  !
stringff! '
idRoomff( .
)ff. /
{ff0 1
trygg 
{gg 
returnhh 
_roomshh 
.hh 
Containshh "
(hh" #
idRoomhh# )
)hh) *
;hh* +
}ii 
catchii 
(ii "
CommunicationExceptionii +
exii, .
)ii. /
{ii0 1

MessageBoxjj 
.jj 
Showjj 
(jj  
$"jj  "
$strjj" <
{jj< =
exjj= ?
.jj? @
Messagejj@ G
}jjG H
"jjH I
)jjI J
;jjJ K
returnkk 
falsekk 
;kk 
}ll 
}mm 	
publicuu 
booluu 
ValidateBoardRoomuu %
(uu% &
stringuu& ,
idRoomuu- 3
)uu3 4
{uu5 6
tryvv 
{vv 
constww 
intww 
MAX_PLAYERSww %
=ww& '
$numww( )
;ww) *
constxx 
intxx 
MIN_PLAYERSxx %
=xx& '
$numxx( )
;xx) *
returnyy 
_playersRoomyy #
.yy# $
ContainsKeyyy$ /
(yy/ 0
idRoomyy0 6
)yy6 7
&&yy8 :
_playersRoomyy; G
[yyG H
idRoomyyH N
]yyN O
.yyO P
PlayersRoomyyP [
.yy[ \
Countyy\ a
>yyb c
MIN_PLAYERSyyd o
&&yyp r
_playersRoomyys 
[	yy 
idRoom
yy 
]
yy 
.
yy 
PlayersRoom
yy 
.
yy 
Count
yy 
<=
yy 
MAX_PLAYERS
yy ¨
;
yy¨ ©
}zz 
catchzz 
(zz "
CommunicationExceptionzz +
exzz, .
)zz. /
{zz0 1

MessageBox{{ 
.{{ 
Show{{ 
({{  
$"{{  "
$str{{" <
{{{< =
ex{{= ?
.{{? @
Message{{@ G
}{{G H
"{{H I
){{I J
;{{J K
return|| 
false|| 
;|| 
}}} 
}~~ 	
} 
public
 

partial
 
class
 
ManagerController
 *
:
+ ,
IMessage
- 5
{
6 7
private
 
static
 
readonly
 

Dictionary
  *
<
* +
string
+ 1
,
1 2
	RoomModel
3 <
>
< =
_playersInRoom
> L
=
M N
new
O R

Dictionary
S ]
<
] ^
string
^ d
,
d e
	RoomModel
f o
>
o p
(
p q
)
q r
;
r s
public
 
void
 
SendMessage
 
(
  
string
  &
message
' .
,
. /
string
0 6
gamertag
7 ?
,
? @
string
A G
idRoom
H N
)
N O
{
P Q
try
 
{
 
if
 
(
 
_playersInRoom
 "
.
" #
ContainsKey
# .
(
. /
idRoom
/ 5
)
5 6
)
6 7
{
8 9
	RoomModel
 
room
 "
=
# $
_playersInRoom
% 3
[
3 4
idRoom
4 :
]
: ;
;
; <
if
 
(
 
room
 
!=
 
null
  $
&&
% '
room
( ,
.
, -
Players
- 4
!=
5 7
null
8 <
)
< =
{
> ?
foreach
 
(
  !
var
! $
players
% ,
in
- /
room
0 4
.
4 5
Players
5 <
.
< =
Values
= C
)
C D
{
E F
players
 #
.
# $!
SendMessageCallback
$ 7
(
7 8
message
8 ?
,
? @
gamertag
A I
)
I J
;
J K
}
 
}
 
}
 
}
 
catch
 
(
 $
CommunicationException
 +
ex
, .
)
. /
{
0 1

MessageBox
 
.
 
Show
 
(
  
$"
  "
$str
" >
{
> ?
ex
? A
.
A B
Message
B I
}
I J
"
J K
)
K L
;
L M
}
 
}
 	
public
¢¢ 
void
¢¢ 
	AddPlayer
¢¢ 
(
¢¢ 
string
¢¢ $
gamertag
¢¢% -
,
¢¢- .
string
¢¢/ 5
idRoom
¢¢6 <
)
¢¢< =
{
¢¢> ?
try
££ 
{
££ 
IMessageCallback
¤¤  
context
¤¤! (
=
¤¤) *
OperationContext
¤¤+ ;
.
¤¤; <
Current
¤¤< C
.
¤¤C D 
GetCallbackChannel
¤¤D V
<
¤¤V W
IMessageCallback
¤¤W g
>
¤¤g h
(
¤¤h i
)
¤¤i j
;
¤¤j k
if
¥¥ 
(
¥¥ 
_playersInRoom
¥¥ "
.
¥¥" #
ContainsKey
¥¥# .
(
¥¥. /
idRoom
¥¥/ 5
)
¥¥5 6
)
¥¥6 7
{
¥¥8 9
	RoomModel
¦¦ 
room
¦¦ "
=
¦¦# $
_playersInRoom
¦¦% 3
[
¦¦3 4
idRoom
¦¦4 :
]
¦¦: ;
;
¦¦; <
room
§§ 
.
§§ 
Players
§§  
.
§§  !
Add
§§! $
(
§§$ %
gamertag
§§% -
,
§§- .
context
§§/ 6
)
§§6 7
;
§§7 8
}
¨¨ 
else
¨¨ 
{
¨¨ 
	RoomModel
©© 
room
©© "
=
©©# $
new
©©% (
	RoomModel
©©) 2
{
©©3 4
IdRoom
ªª 
=
ªª  
idRoom
ªª! '
}
«« 
;
«« 
room
¬¬ 
.
¬¬ 
Players
¬¬  
.
¬¬  !
Add
¬¬! $
(
¬¬$ %
gamertag
¬¬% -
,
¬¬- .
context
¬¬/ 6
)
¬¬6 7
;
¬¬7 8
_playersInRoom
­­ "
.
­­" #
Add
­­# &
(
­­& '
idRoom
­­' -
,
­­- .
room
­­/ 3
)
­­3 4
;
­­4 5
}
®® 
}
¯¯ 
catch
¯¯ 
(
¯¯ $
CommunicationException
¯¯ +
ex
¯¯, .
)
¯¯. /
{
¯¯0 1

MessageBox
°° 
.
°° 
Show
°° 
(
°°  
$"
°°  "
$str
°°" G
{
°°G H
ex
°°H J
.
°°J K
Message
°°K R
}
°°R S
"
°°S T
)
°°T U
;
°°U V
}
±± 
}
²² 	
}
³³ 
public
·· 

partial
·· 
class
·· 
ManagerController
·· *
:
··+ ,
IPlayersRoom
··- 9
{
··: ;
private
¿¿ 
static
¿¿ 
readonly
¿¿ 

Dictionary
¿¿  *
<
¿¿* +
string
¿¿+ 1
,
¿¿1 2
	RoomModel
¿¿3 <
>
¿¿< =
_playersRoom
¿¿> J
=
¿¿K L
new
¿¿M P

Dictionary
¿¿Q [
<
¿¿[ \
string
¿¿\ b
,
¿¿b c
	RoomModel
¿¿d m
>
¿¿m n
(
¿¿n o
)
¿¿o p
;
¿¿p q
private
ÀÀ 
static
ÀÀ 
readonly
ÀÀ 

Dictionary
ÀÀ  *
<
ÀÀ* +
string
ÀÀ+ 1
,
ÀÀ1 2
List
ÀÀ3 7
<
ÀÀ7 8
String
ÀÀ8 >
>
ÀÀ> ?
>
ÀÀ? @$
_playersRoomDictionary
ÀÀA W
=
ÀÀX Y
new
ÀÀZ ]

Dictionary
ÀÀ^ h
<
ÀÀh i
string
ÀÀi o
,
ÀÀo p
List
ÀÀq u
<
ÀÀu v
String
ÀÀv |
>
ÀÀ| }
>
ÀÀ} ~
(
ÀÀ~ 
)ÀÀ 
;ÀÀ 
public
ÁÁ 
void
ÁÁ 
AddPlayerRoom
ÁÁ !
(
ÁÁ! "
string
ÁÁ" (
gamertag
ÁÁ) 1
,
ÁÁ1 2
string
ÁÁ3 9
idRoom
ÁÁ: @
)
ÁÁ@ A
{
ÁÁB C
try
ÂÂ 
{
ÂÂ "
IPlayersRoomCallback
ÃÃ $
context
ÃÃ% ,
=
ÃÃ- .
OperationContext
ÃÃ/ ?
.
ÃÃ? @
Current
ÃÃ@ G
.
ÃÃG H 
GetCallbackChannel
ÃÃH Z
<
ÃÃZ ["
IPlayersRoomCallback
ÃÃ[ o
>
ÃÃo p
(
ÃÃp q
)
ÃÃq r
;
ÃÃr s
if
ÅÅ 
(
ÅÅ 
_rooms
ÅÅ 
.
ÅÅ 
Contains
ÅÅ #
(
ÅÅ# $
idRoom
ÅÅ$ *
)
ÅÅ* +
)
ÅÅ+ ,
{
ÅÅ- .
if
ÆÆ 
(
ÆÆ 
_playersRoom
ÆÆ $
.
ÆÆ$ %
ContainsKey
ÆÆ% 0
(
ÆÆ0 1
idRoom
ÆÆ1 7
)
ÆÆ7 8
)
ÆÆ8 9
{
ÆÆ: ;
	RoomModel
ÇÇ !
room
ÇÇ" &
=
ÇÇ' (
_playersRoom
ÇÇ) 5
[
ÇÇ5 6
idRoom
ÇÇ6 <
]
ÇÇ< =
;
ÇÇ= >
room
ÈÈ 
.
ÈÈ 
PlayersRoom
ÈÈ (
.
ÈÈ( )
Add
ÈÈ) ,
(
ÈÈ, -
gamertag
ÈÈ- 5
,
ÈÈ5 6
context
ÈÈ7 >
)
ÈÈ> ?
;
ÈÈ? @
List
ÉÉ 
<
ÉÉ 
string
ÉÉ #
>
ÉÉ# $
listPlayers
ÉÉ% 0
=
ÉÉ1 2$
_playersRoomDictionary
ÉÉ3 I
[
ÉÉI J
idRoom
ÉÉJ P
]
ÉÉP Q
;
ÉÉQ R
listPlayers
ÊÊ #
.
ÊÊ# $
Add
ÊÊ$ '
(
ÊÊ' (
gamertag
ÊÊ( 0
)
ÊÊ0 1
;
ÊÊ1 2$
_playersRoomDictionary
ËË .
[
ËË. /
idRoom
ËË/ 5
]
ËË5 6
=
ËË7 8
listPlayers
ËË9 D
;
ËËD E
}
ÌÌ 
else
ÌÌ 
{
ÌÌ 
	RoomModel
ÍÍ !
room
ÍÍ" &
=
ÍÍ' (
new
ÍÍ) ,
	RoomModel
ÍÍ- 6
{
ÍÍ7 8
IdRoom
ÎÎ "
=
ÎÎ# $
idRoom
ÎÎ% +
}
ÏÏ 
;
ÏÏ 
room
ÐÐ 
.
ÐÐ 
PlayersRoom
ÐÐ (
.
ÐÐ( )
Add
ÐÐ) ,
(
ÐÐ, -
gamertag
ÐÐ- 5
,
ÐÐ5 6
context
ÐÐ7 >
)
ÐÐ> ?
;
ÐÐ? @
_playersRoom
ÑÑ $
.
ÑÑ$ %
Add
ÑÑ% (
(
ÑÑ( )
idRoom
ÑÑ) /
,
ÑÑ/ 0
room
ÑÑ1 5
)
ÑÑ5 6
;
ÑÑ6 7
List
ÒÒ 
<
ÒÒ 
string
ÒÒ #
>
ÒÒ# $
listPlayers
ÒÒ% 0
=
ÒÒ1 2
new
ÒÒ3 6
List
ÒÒ7 ;
<
ÒÒ; <
string
ÒÒ< B
>
ÒÒB C
(
ÒÒC D
)
ÒÒD E
;
ÒÒE F
listPlayers
ÓÓ #
.
ÓÓ# $
Add
ÓÓ$ '
(
ÓÓ' (
gamertag
ÓÓ( 0
)
ÓÓ0 1
;
ÓÓ1 2$
_playersRoomDictionary
ÔÔ .
.
ÔÔ. /
Add
ÔÔ/ 2
(
ÔÔ2 3
idRoom
ÔÔ3 9
,
ÔÔ9 :
listPlayers
ÔÔ; F
)
ÔÔF G
;
ÔÔG H
}
ÕÕ 
}
ÖÖ 
}
×× 
catch
×× 
(
×× $
CommunicationException
×× +
ex
××, .
)
××. /
{
××0 1

MessageBox
ØØ 
.
ØØ 
Show
ØØ 
(
ØØ  
$"
ØØ  "
$str
ØØ" U
{
ØØU V
ex
ØØV X
.
ØØX Y
Message
ØØY `
}
ØØ` a
"
ØØa b
)
ØØb c
;
ØØc d
}
ÙÙ 
}
ÚÚ 	
public
ââ 
void
ââ 
GetPlayersRoom
ââ "
(
ââ" #
string
ââ# )
gamertag
ââ* 2
,
ââ2 3
string
ââ4 :
idRoom
ââ; A
)
ââA B
{
ââC D
try
ãã 
{
ãã 
if
ää 
(
ää 
_playersRoom
ää  
.
ää  !
ContainsKey
ää! ,
(
ää, -
idRoom
ää- 3
)
ää3 4
)
ää4 5
{
ää6 7
	RoomModel
åå 
room
åå "
=
åå# $
_playersRoom
åå% 1
[
åå1 2
idRoom
åå2 8
]
åå8 9
;
åå9 :
if
ææ 
(
ææ 
room
ææ 
!=
ææ 
null
ææ  $
&&
ææ% '
room
ææ( ,
.
ææ, -
PlayersRoom
ææ- 8
!=
ææ9 ;
null
ææ< @
)
ææ@ A
{
ææB C
List
çç 
<
çç 
string
çç #
>
çç# $
listPlayers
çç% 0
=
çç1 2$
_playersRoomDictionary
çç3 I
[
ççI J
idRoom
ççJ P
]
ççP Q
;
ççQ R
foreach
èè 
(
èè  !
var
èè! $
players
èè% ,
in
èè- /
room
èè0 4
.
èè4 5
PlayersRoom
èè5 @
.
èè@ A
Values
èèA G
)
èèG H
{
èèI J
players
éé #
.
éé# $$
GetPlayersRoomCallback
éé$ :
(
éé: ;
listPlayers
éé; F
)
ééF G
;
ééG H
}
êê 
}
ëë 
}
ìì 
}
íí 
catch
íí 
(
íí $
CommunicationException
íí +
ex
íí, .
)
íí. /
{
íí0 1

MessageBox
îî 
.
îî 
Show
îî 
(
îî  
$"
îî  "
$str
îî" M
{
îîM N
ex
îîN P
.
îîP Q
Message
îîQ X
}
îîX Y
"
îîY Z
)
îîZ [
;
îî[ \
}
ïï 
}
ðð 	
public
÷÷ 
void
÷÷ 
SendToBoard
÷÷ 
(
÷÷  
string
÷÷  &
idRoom
÷÷' -
)
÷÷- .
{
÷÷/ 0
try
øø 
{
øø 
if
ùù 
(
ùù 
_playersRoom
ùù  
.
ùù  !
ContainsKey
ùù! ,
(
ùù, -
idRoom
ùù- 3
)
ùù3 4
)
ùù4 5
{
ùù6 7
	RoomModel
úú 
room
úú "
=
úú# $
_playersRoom
úú% 1
[
úú1 2
idRoom
úú2 8
]
úú8 9
;
úú9 :
if
ûû 
(
ûû 
room
ûû 
!=
ûû 
null
ûû  $
&&
ûû% '
room
ûû( ,
.
ûû, -
PlayersRoom
ûû- 8
!=
ûû9 ;
null
ûû< @
)
ûû@ A
{
ûûB C
foreach
üü 
(
üü  !
var
üü! $
players
üü% ,
in
üü- /
room
üü0 4
.
üü4 5
PlayersRoom
üü5 @
.
üü@ A
Values
üüA G
)
üüG H
{
üüI J
players
ýý #
.
ýý# $!
SendToBoardCallback
ýý$ 7
(
ýý7 8
)
ýý8 9
;
ýý9 :
}
þþ 
}
ÿÿ 
}
 
}
 
catch
 
(
 $
CommunicationException
 +
ex
, .
)
. /
{
0 1

MessageBox
 
.
 
Show
 
(
  
$"
  "
$str
" P
{
P Q
ex
Q S
.
S T
Message
T [
}
[ \
"
\ ]
)
] ^
;
^ _
}
 
}
 	
public
 
void
 
RemovePlayerRoom
 $
(
$ %
string
% +
gamertag
, 4
,
4 5
string
6 <
idRoom
= C
)
C D
{
E F
try
 
{
 
const
 
int
 
MIN_PLAYERS
 %
=
& '
$num
( )
;
) *
if
 
(
 
_playersRoom
  
.
  !
ContainsKey
! ,
(
, -
idRoom
- 3
)
3 4
)
4 5
{
6 7
	RoomModel
 
room
 "
=
# $
_playersRoom
% 1
[
1 2
idRoom
2 8
]
8 9
;
9 :
if
 
(
 $
_playersRoomDictionary
 .
.
. /
ContainsKey
/ :
(
: ;
idRoom
; A
)
A B
)
B C
{
D E
List
 
<
 
string
 #
>
# $
listPlayers
% 0
=
1 2$
_playersRoomDictionary
3 I
[
I J
idRoom
J P
]
P Q
;
Q R
listPlayers
 #
.
# $
Remove
$ *
(
* +
gamertag
+ 3
)
3 4
;
4 5$
_playersRoomDictionary
 .
[
. /
idRoom
/ 5
]
5 6
=
7 8
listPlayers
9 D
;
D E
}
 
if
 
(
 
room
 
.
 
PlayersRoom
 (
.
( )
Count
) .
>
/ 0
MIN_PLAYERS
1 <
)
< =
{
> ?
room
 
.
 
PlayersRoom
 (
.
( )
Remove
) /
(
/ 0
gamertag
0 8
)
8 9
;
9 :
}
 
else
 
{
 
room
 
.
 
Players
 $
.
$ %
Remove
% +
(
+ ,
gamertag
, 4
)
4 5
;
5 6
_playersRoom
 $
.
$ %
Remove
% +
(
+ ,
idRoom
, 2
)
2 3
;
3 4
_rooms
 
.
 
Remove
 %
(
% &
idRoom
& ,
)
, -
;
- .
}
 
}
 
}
 
catch
 
(
 $
CommunicationException
 +
ex
, .
)
. /
{
0 1

MessageBox
   
.
   
Show
   
(
    
$"
    "
$str
  " I
{
  I J
ex
  J L
.
  L M
Message
  M T
}
  T U
"
  U V
)
  V W
;
  W X
}
¡¡ 
}
¢¢ 	
public
©© 
void
©© 
AssignColors
©©  
(
©©  !
string
©©! '
idRoom
©©( .
)
©©. /
{
©©0 1

Dictionary
ªª 
<
ªª 
string
ªª 
,
ªª 
char
ªª #
>
ªª# $$
dictionaryPlayersColor
ªª% ;
=
ªª< =
new
ªª> A

Dictionary
ªªB L
<
ªªL M
string
ªªM S
,
ªªS T
char
ªªU Y
>
ªªY Z
(
ªªZ [
)
ªª[ \
;
ªª\ ]
try
«« 
{
«« 
if
¬¬ 
(
¬¬ 
_playersRoom
¬¬  
.
¬¬  !
TryGetValue
¬¬! ,
(
¬¬, -
idRoom
¬¬- 3
,
¬¬3 4
out
¬¬5 8
var
¬¬9 <
room
¬¬= A
)
¬¬A B
&&
¬¬C E
room
¬¬F J
!=
¬¬K M
null
¬¬N R
&&
¬¬S U
room
¬¬V Z
.
¬¬Z [
PlayersRoom
¬¬[ f
!=
¬¬g i
null
¬¬j n
)
¬¬n o
{
¬¬p q
char
­­ 
[
­­ 
]
­­ 
colors
­­ !
=
­­" #
null
­­$ (
;
­­( )
switch
®® 
(
®® 
room
®®  
.
®®  !
PlayersRoom
®®! ,
.
®®, -
Count
®®- 2
)
®®2 3
{
®®4 5
case
¯¯ 
$num
¯¯ 
:
¯¯ 
colors
°° "
=
°°# $
room
°°% )
.
°°) * 
ColorForTwoPlayers
°°* <
;
°°< =
break
±± !
;
±±! "
case
²² 
$num
²² 
:
²² 
colors
³³ "
=
³³# $
room
³³% )
.
³³) *"
ColorForThreePlayers
³³* >
;
³³> ?
break
´´ !
;
´´! "
case
µµ 
$num
µµ 
:
µµ 
colors
¶¶ "
=
¶¶# $
room
¶¶% )
.
¶¶) *!
ColorForFourPlayers
¶¶* =
;
¶¶= >
break
·· !
;
··! "
case
¸¸ 
$num
¸¸ 
:
¸¸ 
colors
¹¹ "
=
¹¹# $
room
¹¹% )
.
¹¹) *!
ColorForFivePlayers
¹¹* =
;
¹¹= >
break
ºº !
;
ºº! "
case
»» 
$num
»» 
:
»» 
colors
¼¼ "
=
¼¼# $
room
¼¼% )
.
¼¼) * 
ColorForSixPlayers
¼¼* <
;
¼¼< =
break
½½ !
;
½½! "
}
¾¾ 
if
¿¿ 
(
¿¿ 
colors
¿¿ 
!=
¿¿ !
null
¿¿" &
)
¿¿& '
{
¿¿( )
foreach
ÀÀ 
(
ÀÀ  !
var
ÀÀ! $
	playerKey
ÀÀ% .
in
ÀÀ/ 1
room
ÀÀ2 6
.
ÀÀ6 7
PlayersRoom
ÀÀ7 B
.
ÀÀB C
Keys
ÀÀC G
)
ÀÀG H
{
ÀÀI J
char
ÁÁ  
	colorType
ÁÁ! *
=
ÁÁ+ ,
colors
ÁÁ- 3
[
ÁÁ3 4$
dictionaryPlayersColor
ÁÁ4 J
.
ÁÁJ K
Count
ÁÁK P
]
ÁÁP Q
;
ÁÁQ R$
dictionaryPlayersColor
ÂÂ 2
.
ÂÂ2 3
Add
ÂÂ3 6
(
ÂÂ6 7
	playerKey
ÂÂ7 @
,
ÂÂ@ A
	colorType
ÂÂB K
)
ÂÂK L
;
ÂÂL M
}
ÃÃ 
foreach
ÄÄ 
(
ÄÄ  !
var
ÄÄ! $
players
ÄÄ% ,
in
ÄÄ- /
room
ÄÄ0 4
.
ÄÄ4 5
PlayersRoom
ÄÄ5 @
.
ÄÄ@ A
Values
ÄÄA G
)
ÄÄG H
{
ÄÄI J
players
ÅÅ #
.
ÅÅ# $"
AssignColorsCallback
ÅÅ$ 8
(
ÅÅ8 9$
dictionaryPlayersColor
ÅÅ9 O
)
ÅÅO P
;
ÅÅP Q
}
ÆÆ 
}
ÇÇ 
}
ÈÈ 
}
ÉÉ 
catch
ÉÉ 
(
ÉÉ $
CommunicationException
ÉÉ +
ex
ÉÉ, .
)
ÉÉ. /
{
ÉÉ0 1

MessageBox
ÊÊ 
.
ÊÊ 
Show
ÊÊ 
(
ÊÊ  
$"
ÊÊ  "
$str
ÊÊ" @
{
ÊÊ@ A
ex
ÊÊA C
.
ÊÊC D
Message
ÊÊD K
}
ÊÊK L
"
ÊÊL M
)
ÊÊM N
;
ÊÊN O
}
ËË 
}
ÌÌ 	
}
ÍÍ 
}ÎÎ Æ
xC:\Users\alexs\Desktop\JuegoTecno (2)\JuegoTecno\ChineseCheckers\ChineseCheckersLogicServer\Controller\SingletonClass.cs
	namespace 	&
ChineseCheckersLogicServer
 $
.$ %

Controller% /
{0 1
public 

class 
SingletonClass 
{  !
private 
static 
SingletonClass %
	_instance& /
;/ 0
public 
static 
SingletonClass $
Instance% -
{. /
get 
{ 
if 
( 
	_instance 
==  
null! %
)% &
{' (
	_instance 
= 
new  #
SingletonClass$ 2
(2 3
)3 4
;4 5
} 
return 
	_instance  
;  !
} 
} 	
public 
string 
IdRoom 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} ó 
xC:\Users\alexs\Desktop\JuegoTecno (2)\JuegoTecno\ChineseCheckers\ChineseCheckersLogicServer\Controller\UserController.cs
	namespace 	&
ChineseCheckersLogicServer
 $
.$ %

Controller% /
{0 1
[ 
ServiceBehavior 
( 
ConcurrencyMode $
=% &
ConcurrencyMode' 6
.6 7
	Reentrant7 @
)@ A
]A B
public 

partial 
class 
ManagerController *
:+ ,
IUser- 2
{3 4
public## 
int## 
AddUserGame## 
(## 
	UserModel## (
	userModel##) 2
)##2 3
{##4 5
try$$ 
{$$ 
using%% 
(%% 
var%% 
context%% "
=%%# $
new%%% (#
ChineseCheckersEntities%%) @
(%%@ A
)%%A B
)%%B C
using&& 
(&& 
var&& 
transaction&& &
=&&' (
context&&) 0
.&&0 1
Database&&1 9
.&&9 :
BeginTransaction&&: J
(&&J K
)&&K L
)&&L M
{&&N O
var'' 
userGame''  
=''! "
new''# &
User''' +
{'', -
Gamertag((  
=((! "
	userModel((# ,
.((, -
Gamertag((- 5
,((5 6
PlayerStatus)) $
=))% &
	userModel))' 0
.))0 1
PlayerStatus))1 =
,))= >
}** 
;** 
context++ 
.++ 
User++  
.++  !
Add++! $
(++$ %
userGame++% -
)++- .
;++. /
try,, 
{,, 
context-- 
.--  
SaveChanges--  +
(--+ ,
)--, -
;--- .
}.. 
catch.. 
(.. 
DbUpdateException.. .
ex../ 1
)..1 2
{..3 4
transaction// #
.//# $
Rollback//$ ,
(//, -
)//- .
;//. /

MessageBox00 "
.00" #
Show00# '
(00' (
$"00( *
$str00* W
{00W X
ex00X Z
.00Z [
Message00[ b
}00b c
"00c d
)00d e
;00e f
return11 
-11  
$num11  !
;11! "
}22 
transaction33 
.33  
Commit33  &
(33& '
)33' (
;33( )
}44 
}55 
catch55 
(55 
EntityException55 $
ex55% '
)55' (
{55) *

MessageBox66 
.66 
Show66 
(66  
$"66  "
$str66" ?
{66? @
ex66@ B
.66B C
Message66C J
}66J K
"66K L
)66L M
;66M N
return77 
-77 
$num77 
;77 
}88 
return99 
$num99 
;99 
}:: 	
publicBB 
intBB 
AddUserAccountBB !
(BB! "
	UserModelBB" +
	userModelBB, 5
)BB5 6
{BB7 8
tryCC 
{CC 
usingDD 
(DD 
varDD 
contextDD "
=DD# $
newDD% (#
ChineseCheckersEntitiesDD) @
(DD@ A
)DDA B
)DDB C
usingEE 
(EE 
varEE 
transactionEE &
=EE' (
contextEE) 0
.EE0 1
DatabaseEE1 9
.EE9 :
BeginTransactionEE: J
(EEJ K
)EEK L
)EEL M
{EEN O
varFF 
userAccountGameFF '
=FF( )
newFF* -
UserAccountFF. 9
{FF: ;
GamertagUserGG $
=GG% &
	userModelGG' 0
.GG0 1
GamertagGG1 9
,GG9 :
EmailHH 
=HH 
	userModelHH  )
.HH) *
EmailHH* /
,HH/ 0
PasswordII  
=II! "
BCryptII# )
.II) *
NetII* -
.II- .
BCryptII. 4
.II4 5
HashPasswordII5 A
(IIA B
	userModelIIB K
.IIK L
PasswordIIL T
)IIT U
,IIU V
ImageProfileJJ $
=JJ% &
	userModelJJ' 0
.JJ0 1
ImageProfileJJ1 =
,JJ= >
}KK 
;KK 
contextLL 
.LL 
UserAccountLL '
.LL' (
AddLL( +
(LL+ ,
userAccountGameLL, ;
)LL; <
;LL< =
tryMM 
{MM 
contextNN 
.NN  
SaveChangesNN  +
(NN+ ,
)NN, -
;NN- .
}OO 
catchOO 
(OO 
DbUpdateExceptionOO .
exOO/ 1
)OO1 2
{OO3 4
transactionPP #
.PP# $
RollbackPP$ ,
(PP, -
)PP- .
;PP. /

MessageBoxQQ "
.QQ" #
ShowQQ# '
(QQ' (
$"QQ( *
$strQQ* W
{QQW X
exQQX Z
.QQZ [
MessageQQ[ b
}QQb c
"QQc d
)QQd e
;QQe f
returnRR 
-RR  
$numRR  !
;RR! "
}SS 
transactionTT 
.TT  
CommitTT  &
(TT& '
)TT' (
;TT( )
}UU 
}VV 
catchVV 
(VV 
EntityExceptionVV $
exVV% '
)VV' (
{VV) *

MessageBoxWW 
.WW 
ShowWW 
(WW  
$"WW  "
$strWW" I
{WWI J
exWWJ L
.WWL M
MessageWWM T
}WWT U
"WWU V
)WWV W
;WWW X
returnXX 
-XX 
$numXX 
;XX 
}YY 
returnZZ 
$numZZ 
;ZZ 
}[[ 	
publiccc 
	UserModelcc 
InfoUsercc !
(cc! "
stringcc" (
gamertagcc) 1
)cc1 2
{cc3 4
	UserModeldd 
	userModeldd 
=dd  !
newdd" %
	UserModeldd& /
(dd/ 0
)dd0 1
;dd1 2
tryee 
{ee 
usingff 
(ff 
varff 
contextff "
=ff# $
newff% (#
ChineseCheckersEntitiesff) @
(ff@ A
)ffA B
)ffB C
{ffD E
vargg 
	userFoundgg !
=gg" #
contextgg$ +
.gg+ ,
UserAccountgg, 7
.hh 
Wherehh 
(hh 
userhh #
=>hh$ &
userhh' +
.hh+ ,
GamertagUserhh, 8
==hh9 ;
gamertaghh< D
)hhD E
.ii 
Selectii 
(ii  
userii  $
=>ii% '
newii( +
{ii, -
userjj  
.jj  !
GamertagUserjj! -
,jj- .
userkk  
.kk  !
ImageProfilekk! -
,kk- .
userll  
.ll  !
Emailll! &
}mm 
)mm 
.nn 
FirstOrDefaultnn '
(nn' (
)nn( )
;nn) *
ifpp 
(pp 
	userFoundpp !
!=pp" $
nullpp% )
)pp) *
{pp+ ,
	userModelqq !
.qq! "
Gamertagqq" *
=qq+ ,
	userFoundqq- 6
.qq6 7
GamertagUserqq7 C
;qqC D
	userModelrr !
.rr! "
ImageProfilerr" .
=rr/ 0
	userFoundrr1 :
.rr: ;
ImageProfilerr; G
;rrG H
	userModelss !
.ss! "
Emailss" '
=ss( )
	userFoundss* 3
.ss3 4
Emailss4 9
;ss9 :
}tt 
returnuu 
	userModeluu $
;uu$ %
}vv 
}ww 
catchww 
(ww 
EntityExceptionww $
exww% '
)ww' (
{ww) *

MessageBoxxx 
.xx 
Showxx 
(xx  
$"xx  "
$strxx" O
{xxO P
exxxP R
.xxR S
MessagexxS Z
}xxZ [
"xx[ \
)xx\ ]
;xx] ^
returnyy 
nullyy 
;yy 
}zz 
}{{ 	
public
 
int
 
UpdateInfoUser
 !
(
! "
	UserModel
" +
	usermodel
, 5
,
5 6
string
7 =
gamertag
> F
)
F G
{
H I
try
 
{
 
using
 
(
 
var
 
context
 "
=
# $
new
% (%
ChineseCheckersEntities
) @
(
@ A
)
A B
)
B C
using
 
(
 
var
 
transaction
 &
=
' (
context
) 0
.
0 1
Database
1 9
.
9 :
BeginTransaction
: J
(
J K
)
K L
)
L M
{
N O
try
 
{
 
var
 
user
  
=
! "
context
# *
.
* +
UserAccount
+ 6
.
 
Where
 "
(
" #

userUpdate
# -
=>
. 0

userUpdate
1 ;
.
; <
GamertagUser
< H
==
I K
gamertag
L T
)
T U
.
 
FirstOrDefault
 +
(
+ ,
)
, -
;
- .
if
 
(
 
user
  
!=
! #
null
$ (
)
( )
{
* +
user
  
.
  !
Id
! #
=
$ %
	usermodel
& /
.
/ 0
Id
0 2
;
2 3
user
  
.
  !
GamertagUser
! -
=
. /
	usermodel
0 9
.
9 :
Gamertag
: B
;
B C
user
  
.
  !
ImageProfile
! -
=
. /
	usermodel
0 9
.
9 :
ImageProfile
: F
;
F G
user
  
.
  !
Email
! &
=
' (
	usermodel
) 2
.
2 3
Email
3 8
;
8 9
RemoveClient
 (
(
( )
	usermodel
) 2
.
2 3
Id
3 5
)
5 6
;
6 7
context
 #
.
# $
SaveChanges
$ /
(
/ 0
)
0 1
;
1 2
}
 
transaction
 #
.
# $
Commit
$ *
(
* +
)
+ ,
;
, -
return
 
$num
  
;
  !
}
 
catch
 
(
 
DbUpdateException
 .
ex
/ 1
)
1 2
{
3 4
transaction
 #
.
# $
Rollback
$ ,
(
, -
)
- .
;
. /

MessageBox
 "
.
" #
Show
# '
(
' (
$"
( *
$str
* j
{
j k
ex
k m
.
m n
Message
n u
}
u v
"
v w
)
w x
;
x y
return
 
-
  
$num
  !
;
! "
}
 
}
 
}
 
catch
 
(
 
EntityException
 $
ex
% '
)
' (
{
) *

MessageBox
 
.
 
Show
 
(
  
$"
  "
$str
" R
{
R S
ex
S U
.
U V
Message
V ]
}
] ^
"
^ _
)
_ `
;
` a
return
 
-
 
$num
 
;
 
}
   
}
¡¡ 	
public
©© 
int
©© 
UpdatePassword
©© !
(
©©! "
	UserModel
©©" +
	userModel
©©, 5
)
©©5 6
{
©©7 8
try
ªª 
{
ªª 
using
«« 
(
«« 
var
«« 
context
«« "
=
««# $
new
««% (%
ChineseCheckersEntities
««) @
(
««@ A
)
««A B
)
««B C
{
««D E
var
¬¬ 
userAccountUpdate
¬¬ )
=
¬¬* +
context
¬¬, 3
.
¬¬3 4
UserAccount
¬¬4 ?
.
­­( )
Where
­­) .
(
­­. /
user
­­/ 3
=>
­­4 6
user
­­7 ;
.
­­; <
Email
­­< A
==
­­B D
	userModel
­­E N
.
­­N O
Email
­­O T
)
­­T U
.
®®( )
FirstOrDefault
®®) 7
(
®®7 8
)
®®8 9
;
®®9 :
if
¯¯ 
(
¯¯ 
userAccountUpdate
¯¯ )
!=
¯¯* ,
null
¯¯- 1
)
¯¯1 2
{
¯¯3 4
userAccountUpdate
°° )
.
°°) *
Password
°°* 2
=
°°3 4
BCrypt
°°5 ;
.
°°; <
Net
°°< ?
.
°°? @
BCrypt
°°@ F
.
°°F G
HashPassword
°°G S
(
°°S T
	userModel
°°T ]
.
°°] ^
Password
°°^ f
)
°°f g
;
°°g h
}
±± 
return
²² 
context
²² "
.
²²" #
SaveChanges
²²# .
(
²². /
)
²²/ 0
;
²²0 1
}
³³ 
}
´´ 
catch
´´ 
(
´´ 
EntityException
´´ $
ex
´´% '
)
´´' (
{
´´) *

MessageBox
µµ 
.
µµ 
Show
µµ 
(
µµ  
$"
µµ  "
$str
µµ" E
{
µµE F
ex
µµF H
.
µµH I
Message
µµI P
}
µµP Q
"
µµQ R
)
µµR S
;
µµS T
return
¶¶ 
-
¶¶ 
$num
¶¶ 
;
¶¶ 
}
·· 
}
¸¸ 	
public
ÀÀ 
int
ÀÀ 
ValidateUser
ÀÀ 
(
ÀÀ  
	UserModel
ÀÀ  )
	userModel
ÀÀ* 3
)
ÀÀ3 4
{
ÀÀ5 6
try
ÁÁ 
{
ÁÁ 
int
ÂÂ 
userValidated
ÂÂ !
=
ÂÂ" #
$num
ÂÂ$ %
;
ÂÂ% &
using
ÃÃ 
(
ÃÃ 
var
ÃÃ 
context
ÃÃ "
=
ÃÃ# $
new
ÃÃ% (%
ChineseCheckersEntities
ÃÃ) @
(
ÃÃ@ A
)
ÃÃA B
)
ÃÃB C
{
ÃÃD E
var
ÄÄ 
validateUser
ÄÄ $
=
ÄÄ% &
(
ÄÄ' (
from
ÄÄ( ,
user
ÄÄ- 1
in
ÄÄ2 4
context
ÄÄ5 <
.
ÄÄ< =
UserAccount
ÄÄ= H
where
ÅÅ( -
string
ÅÅ. 4
.
ÅÅ4 5
Equals
ÅÅ5 ;
(
ÅÅ; <
user
ÅÅ< @
.
ÅÅ@ A
GamertagUser
ÅÅA M
,
ÅÅM N
	userModel
ÅÅO X
.
ÅÅX Y
Gamertag
ÅÅY a
)
ÅÅa b
select
ÆÆ( .
user
ÆÆ/ 3
)
ÆÆ3 4
.
ÆÆ4 5
FirstOrDefault
ÆÆ5 C
(
ÆÆC D
)
ÆÆD E
;
ÆÆE F
if
ÇÇ 
(
ÇÇ 
validateUser
ÇÇ $
!=
ÇÇ% '
null
ÇÇ( ,
&&
ÇÇ- /
BCrypt
ÇÇ0 6
.
ÇÇ6 7
Net
ÇÇ7 :
.
ÇÇ: ;
BCrypt
ÇÇ; A
.
ÇÇA B
Verify
ÇÇB H
(
ÇÇH I
	userModel
ÇÇI R
.
ÇÇR S
Password
ÇÇS [
,
ÇÇ[ \
validateUser
ÇÇ] i
.
ÇÇi j
Password
ÇÇj r
)
ÇÇr s
)
ÇÇs t
{
ÇÇu v
userValidated
ÈÈ %
=
ÈÈ& '
$num
ÈÈ( )
;
ÈÈ) *
}
ÉÉ 
return
ÊÊ 
userValidated
ÊÊ (
;
ÊÊ( )
}
ËË 
}
ÌÌ 
catch
ÌÌ 
(
ÌÌ 
EntityException
ÌÌ $
ex
ÌÌ% '
)
ÌÌ' (
{
ÌÌ) *

MessageBox
ÍÍ 
.
ÍÍ 
Show
ÍÍ 
(
ÍÍ  
$"
ÍÍ  "
$str
ÍÍ" ?
{
ÍÍ? @
ex
ÍÍ@ B
.
ÍÍB C
Message
ÍÍC J
}
ÍÍJ K
"
ÍÍK L
)
ÍÍL M
;
ÍÍM N
return
ÎÎ 
-
ÎÎ 
$num
ÎÎ 
;
ÎÎ 
}
ÏÏ 
}
ÐÐ 	
public
ØØ 
int
ØØ 
ValidateEmail
ØØ  
(
ØØ  !
	UserModel
ØØ! *
	userModel
ØØ+ 4
)
ØØ4 5
{
ØØ6 7
int
ÙÙ 
emailValidated
ÙÙ 
=
ÙÙ  
$num
ÙÙ! "
;
ÙÙ" #
try
ÚÚ 
{
ÚÚ 
using
ÛÛ 
(
ÛÛ 
var
ÛÛ 
context
ÛÛ "
=
ÛÛ# $
new
ÛÛ% (%
ChineseCheckersEntities
ÛÛ) @
(
ÛÛ@ A
)
ÛÛA B
)
ÛÛB C
{
ÛÛD E
var
ÜÜ 
validatedEmail
ÜÜ &
=
ÜÜ' (
(
ÜÜ) *
from
ÜÜ* .
user
ÜÜ/ 3
in
ÜÜ4 6
context
ÜÜ7 >
.
ÜÜ> ?
UserAccount
ÜÜ? J
where
ÝÝ* /
user
ÝÝ0 4
.
ÝÝ4 5
Email
ÝÝ5 :
==
ÝÝ; =
	userModel
ÝÝ> G
.
ÝÝG H
Email
ÝÝH M
select
ÞÞ* 0
user
ÞÞ1 5
)
ÞÞ5 6
.
ÞÞ6 7
FirstOrDefault
ÞÞ7 E
(
ÞÞE F
)
ÞÞF G
;
ÞÞG H
if
ßß 
(
ßß 
validatedEmail
ßß &
!=
ßß' )
null
ßß* .
)
ßß. /
{
ßß0 1
emailValidated
àà &
=
àà' (
$num
àà) *
;
àà* +
}
áá 
return
ââ 
emailValidated
ââ )
;
ââ) *
}
ãã 
}
ää 
catch
ää 
(
ää 
EntityException
ää $
ex
ää% '
)
ää' (
{
ää) *

MessageBox
åå 
.
åå 
Show
åå 
(
åå  
$"
åå  "
$str
åå" =
{
åå= >
ex
åå> @
.
åå@ A
Message
ååA H
}
ååH I
"
ååI J
)
ååJ K
;
ååK L
return
ææ 
-
ææ 
$num
ææ 
;
ææ 
}
çç 
}
èè 	
public
ðð 
int
ðð 
ValidateGamertag
ðð #
(
ðð# $
	UserModel
ðð$ -
	userModel
ðð. 7
)
ðð7 8
{
ðð9 :
int
ññ 
gamertagValidated
ññ !
=
ññ" #
$num
ññ$ %
;
ññ% &
try
òò 
{
òò 
using
óó 
(
óó 
var
óó 
context
óó "
=
óó# $
new
óó% (%
ChineseCheckersEntities
óó) @
(
óó@ A
)
óóA B
)
óóB C
{
óóD E
var
ôô 
validatedEmail
ôô &
=
ôô' (
(
ôô) *
from
ôô* .
user
ôô/ 3
in
ôô4 6
context
ôô7 >
.
ôô> ?
UserAccount
ôô? J
where
õõ* /
user
õõ0 4
.
õõ4 5
GamertagUser
õõ5 A
==
õõB D
	userModel
õõE N
.
õõN O
Gamertag
õõO W
select
öö* 0
user
öö1 5
)
öö5 6
.
öö6 7
FirstOrDefault
öö7 E
(
ööE F
)
ööF G
;
ööG H
if
÷÷ 
(
÷÷ 
validatedEmail
÷÷ &
!=
÷÷' )
null
÷÷* .
)
÷÷. /
{
÷÷0 1
gamertagValidated
øø )
=
øø* +
$num
øø, -
;
øø- .
}
ùù 
return
úú 
gamertagValidated
úú ,
;
úú, -
}
ûû 
}
üü 
catch
üü 
(
üü 
EntityException
üü $
ex
üü% '
)
üü' (
{
üü) *

MessageBox
ýý 
.
ýý 
Show
ýý 
(
ýý  
$"
ýý  "
$str
ýý" @
{
ýý@ A
ex
ýýA C
.
ýýC D
Message
ýýD K
}
ýýK L
"
ýýL M
)
ýýM N
;
ýýN O
return
þþ 
-
þþ 
$num
þþ 
;
þþ 
}
ÿÿ 
}
 	
public
 
string
 
GetPlayerImage
 $
(
$ %
string
% +
gamertag
, 4
)
4 5
{
6 7
string
 
path
 
=
 
$str
 
;
 
try
 
{
 
using
 
(
 
var
 
context
 "
=
# $
new
% (%
ChineseCheckersEntities
) @
(
@ A
)
A B
)
B C
{
D E
var
 
playerImage
 #
=
$ %
(
& '
from
' +
user
, 0
in
1 3
context
4 ;
.
; <
UserAccount
< G
where
' ,
string
- 3
.
3 4
Equals
4 :
(
: ;
user
; ?
.
? @
GamertagUser
@ L
,
L M
gamertag
N V
)
V W
select
' -
user
. 2
)
2 3
.
3 4
FirstOrDefault
4 B
(
B C
)
C D
;
D E
if
 
(
 
playerImage
 #
!=
$ &
null
' +
)
+ ,
{
- .
path
 
=
 
$str
 3
+
4 5
playerImage
6 A
.
A B
ImageProfile
B N
;
N O
}
 
return
 
path
 
;
  
}
 
}
 
catch
 
(
 
EntityException
 $
ex
% '
)
' (
{
) *

MessageBox
 
.
 
Show
 
(
  
$"
  "
$str
" H
{
H I
ex
I K
.
K L
Message
L S
}
S T
"
T U
)
U V
;
V W
return
 
null
 
;
 
}
 
}
 	
public
 
void
 

LogoutUser
 
(
 
int
 "
idUser
# )
)
) *
{
+ ,
try
   
{
   
RemoveClient
¡¡ 
(
¡¡ 
idUser
¡¡ #
)
¡¡# $
;
¡¡$ %
}
¢¢ 
catch
¢¢ 
(
¢¢ $
CommunicationException
¢¢ +
ex
¢¢, .
)
¢¢. /
{
¢¢0 1

MessageBox
££ 
.
££ 
Show
££ 
(
££  
$"
££  "
$str
££" :
{
££: ;
ex
££; =
.
££= >
Message
££> E
}
££E F
"
££F G
)
££G H
;
££H I
}
¤¤ 
}
¥¥ 	
public
®® 
string
®® 
FindGamertag
®® "
(
®®" #
string
®®# )
currentGamertag
®®* 9
,
®®9 :
string
®®; A
friendGamertag
®®B P
)
®®P Q
{
®®R S
string
¯¯ 
gamertagToFound
¯¯ "
=
¯¯# $
$str
¯¯% '
;
¯¯' (
try
°° 
{
°° 
using
±± 
(
±± 
var
±± 
context
±± "
=
±±# $
new
±±% (%
ChineseCheckersEntities
±±) @
(
±±@ A
)
±±A B
)
±±B C
{
±±D E
var
²² 
currentUser
²² #
=
²²$ %
context
²²& -
.
²²- .
UserAccount
²². 9
.
²²9 :
FirstOrDefault
²²: H
(
²²H I
user
²²I M
=>
²²N P
user
²²Q U
.
²²U V
GamertagUser
²²V b
==
²²c e
currentGamertag
²²f u
)
²²u v
;
²²v w
var
³³ 

friendUser
³³ "
=
³³# $
context
³³% ,
.
³³, -
UserAccount
³³- 8
.
³³8 9
FirstOrDefault
³³9 G
(
³³G H
user
³³H L
=>
³³M O
user
³³P T
.
³³T U
GamertagUser
³³U a
==
³³b d
friendGamertag
³³e s
)
³³s t
;
³³t u
if
µµ 
(
µµ 
currentUser
µµ #
!=
µµ$ &
null
µµ' +
&&
µµ, .

friendUser
µµ/ 9
!=
µµ: <
null
µµ= A
&&
µµB D
currentGamertag
µµE T
!=
µµU W
friendGamertag
µµX f
)
µµf g
{
µµh i
var
¶¶ 

areFriends
¶¶ &
=
¶¶' (
context
¶¶) 0
.
¶¶0 1
FriendPlayer
¶¶1 =
.
¶¶= >
Any
¶¶> A
(
¶¶A B
friend
¶¶B H
=>
¶¶I K
(
·· 
friend
·· #
.
··# $
IdPlayer
··$ ,
==
··- /
currentUser
··0 ;
.
··; <
Id
··< >
&&
··? A
friend
··B H
.
··H I
IdFriend
··I Q
==
··R T

friendUser
··U _
.
··_ `
Id
··` b
&&
··c e
friend
··f l
.
··l m
RequestStatus
··m z
==
··{ }
$str··~ 
)·· 
||·· 
(
¸¸ 
friend
¸¸ #
.
¸¸# $
IdPlayer
¸¸$ ,
==
¸¸- /

friendUser
¸¸0 :
.
¸¸: ;
Id
¸¸; =
&&
¸¸> @
friend
¸¸A G
.
¸¸G H
IdFriend
¸¸H P
==
¸¸Q S
currentUser
¸¸T _
.
¸¸_ `
Id
¸¸` b
&&
¸¸c e
friend
¸¸f l
.
¸¸l m
RequestStatus
¸¸m z
==
¸¸{ }
$str¸¸~ 
)¸¸ 
)¸¸ 
;¸¸ 
if
ºº 
(
ºº 
!
ºº 

areFriends
ºº '
)
ºº' (
{
ºº) *
gamertagToFound
»» +
=
»», -
friendGamertag
»». <
;
»»< =
}
¼¼ 
}
½½ 
return
¾¾ 
gamertagToFound
¾¾ *
;
¾¾* +
}
¿¿ 
}
ÀÀ 
catch
ÀÀ 
(
ÀÀ 
EntityException
ÀÀ $
ex
ÀÀ% '
)
ÀÀ' (
{
ÀÀ) *

MessageBox
ÁÁ 
.
ÁÁ 
Show
ÁÁ 
(
ÁÁ  
$"
ÁÁ  "
$str
ÁÁ" ?
{
ÁÁ? @
ex
ÁÁ@ B
.
ÁÁB C
Message
ÁÁC J
}
ÁÁJ K
"
ÁÁK L
)
ÁÁL M
;
ÁÁM N
return
ÂÂ 
null
ÂÂ 
;
ÂÂ 
}
ÃÃ 
}
ÄÄ 	
public
ÌÌ 
string
ÌÌ 
GetEmail
ÌÌ 
(
ÌÌ 
string
ÌÌ %
gamertag
ÌÌ& .
)
ÌÌ. /
{
ÌÌ0 1
string
ÍÍ 
email
ÍÍ 
=
ÍÍ 
$str
ÍÍ 
;
ÍÍ 
try
ÎÎ 
{
ÎÎ 
using
ÏÏ 
(
ÏÏ 
var
ÏÏ 
context
ÏÏ "
=
ÏÏ# $
new
ÏÏ% (%
ChineseCheckersEntities
ÏÏ) @
(
ÏÏ@ A
)
ÏÏA B
)
ÏÏB C
{
ÏÏD E
var
ÐÐ 
user
ÐÐ 
=
ÐÐ 
context
ÐÐ &
.
ÐÐ& '
UserAccount
ÐÐ' 2
.
ÑÑ 
FirstOrDefault
ÑÑ '
(
ÑÑ' (
	userEmail
ÑÑ( 1
=>
ÑÑ2 4
	userEmail
ÑÑ5 >
.
ÑÑ> ?
GamertagUser
ÑÑ? K
==
ÑÑL N
gamertag
ÑÑO W
)
ÑÑW X
;
ÑÑX Y
if
ÓÓ 
(
ÓÓ 
user
ÓÓ 
!=
ÓÓ 
null
ÓÓ  $
)
ÓÓ$ %
{
ÓÓ& '
email
ÔÔ 
=
ÔÔ 
user
ÔÔ  $
.
ÔÔ$ %
Email
ÔÔ% *
;
ÔÔ* +
}
ÕÕ 
return
ÖÖ 
email
ÖÖ  
;
ÖÖ  !
}
×× 
}
ØØ 
catch
ØØ 
(
ØØ 
EntityException
ØØ $
ex
ØØ% '
)
ØØ' (
{
ØØ) *

MessageBox
ÙÙ 
.
ÙÙ 
Show
ÙÙ 
(
ÙÙ  
$"
ÙÙ  "
$str
ÙÙ" >
{
ÙÙ> ?
ex
ÙÙ? A
.
ÙÙA B
Message
ÙÙB I
}
ÙÙI J
"
ÙÙJ K
)
ÙÙK L
;
ÙÙL M
return
ÚÚ 
null
ÚÚ 
;
ÚÚ 
}
ÛÛ 
}
ÜÜ 	
public
ää 
int
ää 
GetId
ää 
(
ää 
string
ää 
gamertag
ää  (
)
ää( )
{
ää* +
int
åå 
id
åå 
=
åå 
$num
åå 
;
åå 
try
ææ 
{
ææ 
using
çç 
(
çç 
var
çç 
context
çç "
=
çç# $
new
çç% (%
ChineseCheckersEntities
çç) @
(
çç@ A
)
ççA B
)
ççB C
{
ççD E
var
èè 
user
èè 
=
èè 
context
èè &
.
èè& '
UserAccount
èè' 2
.
éé 
FirstOrDefault
éé '
(
éé' (
userId
éé( .
=>
éé/ 1
userId
éé2 8
.
éé8 9
GamertagUser
éé9 E
==
ééF H
gamertag
ééI Q
)
ééQ R
;
ééR S
if
ëë 
(
ëë 
user
ëë 
!=
ëë 
null
ëë  $
)
ëë$ %
{
ëë& '
id
ìì 
=
ìì 
user
ìì !
.
ìì! "
Id
ìì" $
;
ìì$ %
}
íí 
return
îî 
id
îî 
;
îî 
}
ïï 
}
ðð 
catch
ðð 
(
ðð 
EntityException
ðð $
ex
ðð% '
)
ðð' (
{
ðð) *

MessageBox
ññ 
.
ññ 
Show
ññ 
(
ññ  
$"
ññ  "
$str
ññ" :
{
ññ: ;
ex
ññ; =
.
ññ= >
Message
ññ> E
}
ññE F
"
ññF G
)
ññG H
;
ññH I
return
òò 
-
òò 
$num
òò 
;
òò 
}
óó 
}
ôô 	
public
üü 
int
üü 
UpdateGamesWon
üü !
(
üü! "
int
üü" %
idUser
üü& ,
)
üü, -
{
üü. /
try
ýý 
{
ýý 
const
þþ 
int
þþ 
	MIN_GAMES
þþ #
=
þþ$ %
$num
þþ& '
;
þþ' (
using
ÿÿ 
(
ÿÿ 
var
ÿÿ 
context
ÿÿ "
=
ÿÿ# $
new
ÿÿ% (%
ChineseCheckersEntities
ÿÿ) @
(
ÿÿ@ A
)
ÿÿA B
)
ÿÿB C
{
ÿÿD E
var
 
user
 
=
 
context
 &
.
& '
User
' +
.
 
FirstOrDefault
 '
(
' (
userId
( .
=>
/ 1
userId
2 8
.
8 9
Id
9 ;
==
< >
idUser
? E
)
E F
;
F G
if
 
(
 
user
 
!=
 
null
  $
)
$ %
{
& '
if
 
(
 
user
  
.
  !
GamesWon
! )
==
* ,
null
- 1
)
1 2
{
3 4
user
  
.
  !
GamesWon
! )
=
* +
	MIN_GAMES
, 5
;
5 6
}
 
else
 
{
  
user
  
.
  !
GamesWon
! )
++
) +
;
+ ,
}
 
}
 
return
 
context
 "
.
" #
SaveChanges
# .
(
. /
)
/ 0
;
0 1
}
 
}
 
catch
 
(
 
EntityException
 $
ex
% '
)
' (
{
) *

MessageBox
 
.
 
Show
 
(
  
$"
  "
$str
" J
{
J K
ex
K M
.
M N
Message
N U
}
U V
"
V W
)
W X
;
X Y
return
 
-
 
$num
 
;
 
}
 
}
 	
public
 
int
 
UpdateTotalGames
 #
(
# $
int
$ '
idUser
( .
)
. /
{
0 1
try
 
{
 
const
 
int
 
	MIN_GAMES
 #
=
$ %
$num
& '
;
' (
using
 
(
 
var
 
context
 "
=
# $
new
% (%
ChineseCheckersEntities
) @
(
@ A
)
A B
)
B C
{
D E
var
 
user
 
=
 
context
 &
.
& '
User
' +
.
 
FirstOrDefault
 '
(
' (
userId
( .
=>
/ 1
userId
2 8
.
8 9
Id
9 ;
==
< >
idUser
? E
)
E F
;
F G
if
 
(
 
user
 
!=
 
null
  $
)
$ %
{
& '
if
 
(
 
user
  
.
  !
NumberGames
! ,
==
- /
null
0 4
)
4 5
{
6 7
user
  
.
  !
NumberGames
! ,
=
- .
	MIN_GAMES
/ 8
;
8 9
}
   
else
   
{
    
user
¡¡  
.
¡¡  !
NumberGames
¡¡! ,
++
¡¡, .
;
¡¡. /
}
¢¢ 
}
££ 
return
¤¤ 
context
¤¤ "
.
¤¤" #
SaveChanges
¤¤# .
(
¤¤. /
)
¤¤/ 0
;
¤¤0 1
}
¥¥ 
}
¦¦ 
catch
¦¦ 
(
¦¦ 
EntityException
¦¦ $
ex
¦¦% '
)
¦¦' (
{
¦¦) *

MessageBox
§§ 
.
§§ 
Show
§§ 
(
§§  
$"
§§  "
$str
§§" J
{
§§J K
ex
§§K M
.
§§M N
Message
§§N U
}
§§U V
"
§§V W
)
§§W X
;
§§X Y
return
¨¨ 
-
¨¨ 
$num
¨¨ 
;
¨¨ 
}
©© 
}
ªª 	
public
²² 
int
²² 
GetTotalGames
²²  
(
²²  !
int
²²! $
idUser
²²% +
)
²²+ ,
{
²²- .
int
³³ 

totalGames
³³ 
=
³³ 
$num
³³ 
;
³³ 
try
´´ 
{
´´ 
const
µµ 
int
µµ 
	MIN_GAMES
µµ #
=
µµ$ %
$num
µµ& '
;
µµ' (
using
¶¶ 
(
¶¶ 
var
¶¶ 
context
¶¶ "
=
¶¶# $
new
¶¶% (%
ChineseCheckersEntities
¶¶) @
(
¶¶@ A
)
¶¶A B
)
¶¶B C
{
¶¶D E
var
·· 
user
·· 
=
·· 
context
·· &
.
··& '
User
··' +
.
¸¸ 
FirstOrDefault
¸¸ '
(
¸¸' (
userId
¸¸( .
=>
¸¸/ 1
userId
¸¸2 8
.
¸¸8 9
Id
¸¸9 ;
==
¸¸< >
idUser
¸¸? E
)
¸¸E F
;
¸¸F G
if
¹¹ 
(
¹¹ 
user
¹¹ 
!=
¹¹ 
null
¹¹  $
)
¹¹$ %
{
¹¹& '
if
ºº 
(
ºº 
user
ºº  
.
ºº  !
NumberGames
ºº! ,
==
ºº- /
null
ºº0 4
)
ºº4 5
{
ºº6 7
user
»»  
.
»»  !
NumberGames
»»! ,
=
»»- .
	MIN_GAMES
»»/ 8
;
»»8 9
}
¼¼ 
else
¼¼ 
{
¼¼  

totalGames
½½ &
=
½½' (
(
½½) *
int
½½* -
)
½½- .
user
½½. 2
.
½½2 3
NumberGames
½½3 >
;
½½> ?
}
¾¾ 
}
¿¿ 
}
ÀÀ 
}
ÁÁ 
catch
ÁÁ 
(
ÁÁ 
EntityException
ÁÁ $
ex
ÁÁ% '
)
ÁÁ' (
{
ÁÁ) *

MessageBox
ÂÂ 
.
ÂÂ 
Show
ÂÂ 
(
ÂÂ  
$"
ÂÂ  "
$str
ÂÂ" G
{
ÂÂG H
ex
ÂÂH J
.
ÂÂJ K
Message
ÂÂK R
}
ÂÂR S
"
ÂÂS T
)
ÂÂT U
;
ÂÂU V
return
ÃÃ 
-
ÃÃ 
$num
ÃÃ 
;
ÃÃ 
}
ÄÄ 
return
ÅÅ 

totalGames
ÅÅ 
;
ÅÅ 
}
ÆÆ 	
public
ÎÎ 
int
ÎÎ 
GetGamesWon
ÎÎ 
(
ÎÎ 
int
ÎÎ "
idUser
ÎÎ# )
)
ÎÎ) *
{
ÎÎ+ ,
int
ÏÏ 
gamesWon
ÏÏ 
=
ÏÏ 
$num
ÏÏ 
;
ÏÏ 
try
ÐÐ 
{
ÐÐ 
const
ÑÑ 
int
ÑÑ 
	MIN_GAMES
ÑÑ #
=
ÑÑ$ %
$num
ÑÑ& '
;
ÑÑ' (
using
ÒÒ 
(
ÒÒ 
var
ÒÒ 
context
ÒÒ "
=
ÒÒ# $
new
ÒÒ% (%
ChineseCheckersEntities
ÒÒ) @
(
ÒÒ@ A
)
ÒÒA B
)
ÒÒB C
{
ÒÒD E
var
ÓÓ 
user
ÓÓ 
=
ÓÓ 
context
ÓÓ &
.
ÓÓ& '
User
ÓÓ' +
.
ÔÔ 
FirstOrDefault
ÔÔ '
(
ÔÔ' (
userId
ÔÔ( .
=>
ÔÔ/ 1
userId
ÔÔ2 8
.
ÔÔ8 9
Id
ÔÔ9 ;
==
ÔÔ< >
idUser
ÔÔ? E
)
ÔÔE F
;
ÔÔF G
if
ÕÕ 
(
ÕÕ 
user
ÕÕ 
!=
ÕÕ 
null
ÕÕ  $
)
ÕÕ$ %
{
ÕÕ& '
if
ÖÖ 
(
ÖÖ 
user
ÖÖ  
.
ÖÖ  !
GamesWon
ÖÖ! )
==
ÖÖ* ,
null
ÖÖ- 1
)
ÖÖ1 2
{
ÖÖ3 4
user
××  
.
××  !
GamesWon
××! )
=
××* +
	MIN_GAMES
××, 5
;
××5 6
}
ØØ 
else
ØØ 
{
ØØ  
gamesWon
ÙÙ $
=
ÙÙ% &
(
ÙÙ' (
int
ÙÙ( +
)
ÙÙ+ ,
user
ÙÙ, 0
.
ÙÙ0 1
GamesWon
ÙÙ1 9
;
ÙÙ9 :
}
ÚÚ 
}
ÛÛ 
}
ÜÜ 
}
ÝÝ 
catch
ÝÝ 
(
ÝÝ 
EntityException
ÝÝ $
ex
ÝÝ% '
)
ÝÝ' (
{
ÝÝ) *

MessageBox
ÞÞ 
.
ÞÞ 
Show
ÞÞ 
(
ÞÞ  
$"
ÞÞ  "
$str
ÞÞ" G
{
ÞÞG H
ex
ÞÞH J
.
ÞÞJ K
Message
ÞÞK R
}
ÞÞR S
"
ÞÞS T
)
ÞÞT U
;
ÞÞU V
return
ßß 
-
ßß 
$num
ßß 
;
ßß 
}
àà 
return
áá 
gamesWon
áá 
;
áá 
}
ââ 	
public
ëë 
int
ëë  
UpdateStatusPlayer
ëë %
(
ëë% &
int
ëë& )
idUser
ëë* 0
,
ëë0 1
bool
ëë2 6
status
ëë7 =
)
ëë= >
{
ëë? @
try
ìì 
{
ìì 
const
íí 
string
íí "
PLAYER_STATUS_BANNED
íí 1
=
íí2 3
$str
íí4 7
;
íí7 8
const
îî 
string
îî "
PLAYER_STATUS_ACTIVE
îî 1
=
îî2 3
$str
îî4 7
;
îî7 8
using
ïï 
(
ïï 
var
ïï 
context
ïï "
=
ïï# $
new
ïï% (%
ChineseCheckersEntities
ïï) @
(
ïï@ A
)
ïïA B
)
ïïB C
{
ïïD E
var
ðð 
user
ðð 
=
ðð 
context
ðð &
.
ðð& '
User
ðð' +
.
ññ 
FirstOrDefault
ññ '
(
ññ' (
userId
ññ( .
=>
ññ/ 1
userId
ññ2 8
.
ññ8 9
Id
ññ9 ;
==
ññ< >
idUser
ññ? E
)
ññE F
;
ññF G
if
òò 
(
òò 
user
òò 
!=
òò 
null
òò  $
)
òò$ %
{
òò& '
if
óó 
(
óó 
status
óó "
)
óó" #
{
óó$ %
user
ôô  
.
ôô  !
PlayerStatus
ôô! -
=
ôô. /"
PLAYER_STATUS_ACTIVE
ôô0 D
;
ôôD E
}
õõ 
else
õõ 
{
õõ  
user
öö  
.
öö  !
PlayerStatus
öö! -
=
öö. /"
PLAYER_STATUS_BANNED
öö0 D
;
ööD E
}
÷÷ 
}
øø 
return
ùù 
context
ùù "
.
ùù" #
SaveChanges
ùù# .
(
ùù. /
)
ùù/ 0
;
ùù0 1
}
úú 
}
ûû 
catch
ûû 
(
ûû 
EntityException
ûû $
ex
ûû% '
)
ûû' (
{
ûû) *

MessageBox
üü 
.
üü 
Show
üü 
(
üü  
$"
üü  "
$str
üü" M
{
üüM N
ex
üüN P
.
üüP Q
Message
üüQ X
}
üüX Y
"
üüY Z
)
üüZ [
;
üü[ \
return
ýý 
-
ýý 
$num
ýý 
;
ýý 
}
þþ 
}
ÿÿ 	
public
 

Dictionary
 
<
 
string
  
,
  !
int
" %
>
% &
GetGames
' /
(
/ 0
)
0 1
{
2 3

Dictionary
 
<
 
string
 
,
 
int
 "
>
" #
_bestPlayers
$ 0
=
1 2
new
3 6

Dictionary
7 A
<
A B
string
B H
,
H I
int
J M
>
M N
(
N O
)
O P
;
P Q
try
 
{
 
const
 
int
 
BEST_PLAYERS
 &
=
' (
$num
) *
;
* +
using
 
(
 
var
 
context
 "
=
# $
new
% (%
ChineseCheckersEntities
) @
(
@ A
)
A B
)
B C
{
D E
var
 
bestPlayers
 #
=
$ %
context
& -
.
- .
User
. 2
.
 
Where
 
(
 
user
 #
=>
$ &
user
' +
.
+ ,
GamesWon
, 4
!=
5 7
null
8 <
)
< =
.
 
OrderByDescending
 *
(
* +
user
+ /
=>
0 2
user
3 7
.
7 8
GamesWon
8 @
)
@ A
.
 
Take
 
(
 
BEST_PLAYERS
 *
)
* +
.
 
ToList
 
(
  
)
  !
;
! "
_bestPlayers
  
=
! "
bestPlayers
# .
.
. /
ToDictionary
/ ;
(
; <
user
< @
=>
A C
user
D H
.
H I
Gamertag
I Q
,
Q R
user
S W
=>
X Z
user
[ _
.
_ `
GamesWon
` h
.
h i
Value
i n
)
n o
;
o p
}
 
}
 
catch
 
(
 
EntityException
 $
ex
% '
)
' (
{
) *

MessageBox
 
.
 
Show
 
(
  
$"
  "
$str
" D
{
D E
ex
E G
.
G H
Message
H O
}
O P
"
P Q
)
Q R
;
R S
}
 
return
 
_bestPlayers
 
;
  
}
 	
}
 
public
 

partial
 
class
 
ManagerController
 *
:
+ ,
IUsersManager
- :
{
; <
private
¢¢ 
static
¢¢ 
readonly
¢¢ 

Dictionary
¢¢  *
<
¢¢* +
int
¢¢+ .
,
¢¢. /"
IUserSessionCallback
¢¢0 D
>
¢¢D E
playerStatus
¢¢F R
=
¢¢S T
new
¢¢U X

Dictionary
¢¢Y c
<
¢¢c d
int
¢¢d g
,
¢¢g h"
IUserSessionCallback
¢¢i }
>
¢¢} ~
(
¢¢~ 
)¢¢ 
;¢¢ 
public
££ 
void
££ 

GetFriends
££ 
(
££ 
string
££ %
gamertag
££& .
)
££. /
{
££0 1

Dictionary
¤¤ 
<
¤¤ 
string
¤¤ 
,
¤¤ 
Tuple
¤¤ $
<
¤¤$ %
string
¤¤% +
,
¤¤+ ,
bool
¤¤- 1
>
¤¤1 2
>
¤¤2 3
friendsDictionary
¤¤4 E
=
¤¤F G
new
¤¤H K

Dictionary
¤¤L V
<
¤¤V W
string
¤¤W ]
,
¤¤] ^
Tuple
¤¤_ d
<
¤¤d e
string
¤¤e k
,
¤¤k l
bool
¤¤m q
>
¤¤q r
>
¤¤r s
(
¤¤s t
)
¤¤t u
;
¤¤u v
try
¥¥ 
{
¥¥ 
const
¦¦ 
string
¦¦ 
FRIEND_REQUEST
¦¦ +
=
¦¦, -
$str
¦¦. 8
;
¦¦8 9
using
§§ 
(
§§ 
var
§§ 
context
§§ "
=
§§# $
new
§§% (%
ChineseCheckersEntities
§§) @
(
§§@ A
)
§§A B
)
§§B C
{
§§D E
int
¨¨ 
userId
¨¨ 
=
¨¨  
context
¨¨! (
.
¨¨( )
UserAccount
¨¨) 4
.
©© 
Where
©© 
(
©© 
user
©© #
=>
©©$ &
user
©©' +
.
©©+ ,
GamertagUser
©©, 8
==
©©9 ;
gamertag
©©< D
)
©©D E
.
ªª 
Select
ªª 
(
ªª  
user
ªª  $
=>
ªª% '
user
ªª( ,
.
ªª, -
Id
ªª- /
)
ªª/ 0
.
«« 
FirstOrDefault
«« '
(
««' (
)
««( )
;
««) *
if
¬¬ 
(
¬¬ 
userId
¬¬ 
>
¬¬  
$num
¬¬! "
)
¬¬" #
{
¬¬$ %
var
­­ 

friendData
­­ &
=
­­' (
(
­­) *
from
­­* .
friend
­­/ 5
in
­­6 8
context
­­9 @
.
­­@ A
FriendPlayer
­­A M
join
®®* .
user
®®/ 3
in
®®4 6
context
®®7 >
.
®®> ?
UserAccount
®®? J
on
®®K M
friend
®®N T
.
®®T U
IdFriend
®®U ]
equals
®®^ d
user
®®e i
.
®®i j
Id
®®j l
where
¯¯* /
friend
¯¯0 6
.
¯¯6 7
IdPlayer
¯¯7 ?
==
¯¯@ B
userId
¯¯C I
&&
¯¯J L
friend
¯¯M S
.
¯¯S T
RequestStatus
¯¯T a
==
¯¯b d
FRIEND_REQUEST
¯¯e s
select
°°* 0
new
°°1 4
{
°°5 6
user
±±. 2
.
±±2 3
Id
±±3 5
,
±±5 6
Gamertag
²². 6
=
²²7 8
user
²²9 =
.
²²= >
GamertagUser
²²> J
,
²²J K
user
³³. 2
.
³³2 3
ImageProfile
³³3 ?
,
³³? @
}
´´* +
)
´´+ ,
.
´´, -
ToList
´´- 3
(
´´3 4
)
´´4 5
;
´´5 6
foreach
µµ 
(
µµ  !
var
µµ! $
friend
µµ% +
in
µµ, .

friendData
µµ/ 9
)
µµ9 :
{
µµ; <
bool
¶¶  
isOnline
¶¶! )
=
¶¶* +
playerStatus
¶¶, 8
.
¶¶8 9
ContainsKey
¶¶9 D
(
¶¶D E
friend
¶¶E K
.
¶¶K L
Id
¶¶L N
)
¶¶N O
;
¶¶O P
friendsDictionary
·· -
[
··- .
friend
··. 4
.
··4 5
Gamertag
··5 =
]
··= >
=
··? @
new
··A D
Tuple
··E J
<
··J K
string
··K Q
,
··Q R
bool
··S W
>
··W X
(
··X Y
friend
··Y _
.
··_ `
ImageProfile
··` l
,
··l m
isOnline
··n v
)
··v w
;
··w x
}
¸¸ 
IUserCallback
¹¹ %
callback
¹¹& .
=
¹¹/ 0
OperationContext
¹¹1 A
.
¹¹A B
Current
¹¹B I
.
¹¹I J 
GetCallbackChannel
¹¹J \
<
¹¹\ ]
IUserCallback
¹¹] j
>
¹¹j k
(
¹¹k l
)
¹¹l m
;
¹¹m n
callback
ºº  
.
ºº  ! 
GetFriendsCallback
ºº! 3
(
ºº3 4
friendsDictionary
ºº4 E
)
ººE F
;
ººF G
}
»» 
}
¼¼ 
}
½½ 
catch
½½ 
(
½½ 
EntityException
½½ $
ex
½½% '
)
½½' (
{
½½) *

MessageBox
¾¾ 
.
¾¾ 
Show
¾¾ 
(
¾¾  
$"
¾¾  "
$str
¾¾" G
{
¾¾G H
ex
¾¾H J
.
¾¾J K
Message
¾¾K R
}
¾¾R S
"
¾¾S T
)
¾¾T U
;
¾¾U V
}
¿¿ 
catch
¿¿ 
(
¿¿ $
CommunicationException
¿¿ +
ex
¿¿, .
)
¿¿. /
{
¿¿0 1

MessageBox
ÀÀ 
.
ÀÀ 
Show
ÀÀ 
(
ÀÀ  
$"
ÀÀ  "
$str
ÀÀ" G
{
ÀÀG H
ex
ÀÀH J
.
ÀÀJ K
Message
ÀÀK R
}
ÀÀR S
"
ÀÀS T
)
ÀÀT U
;
ÀÀU V
}
ÁÁ 
}
ÂÂ 	
private
ÉÉ 
void
ÉÉ 
RemoveClient
ÉÉ !
(
ÉÉ! "
int
ÉÉ" %
idUser
ÉÉ& ,
)
ÉÉ, -
{
ÉÉ. /
try
ÊÊ 
{
ÊÊ 
if
ËË 
(
ËË 
playerStatus
ËË  
.
ËË  !
ContainsKey
ËË! ,
(
ËË, -
idUser
ËË- 3
)
ËË3 4
)
ËË4 5
{
ËË6 7
playerStatus
ÌÌ  
.
ÌÌ  !
Remove
ÌÌ! '
(
ÌÌ' (
idUser
ÌÌ( .
)
ÌÌ. /
;
ÌÌ/ 0
}
ÍÍ 
}
ÎÎ 
catch
ÎÎ 
(
ÎÎ $
CommunicationException
ÎÎ +
ex
ÎÎ, .
)
ÎÎ. /
{
ÎÎ0 1

MessageBox
ÏÏ 
.
ÏÏ 
Show
ÏÏ 
(
ÏÏ  
$"
ÏÏ  "
$str
ÏÏ" ?
{
ÏÏ? @
ex
ÏÏ@ B
.
ÏÏB C
Message
ÏÏC J
}
ÏÏJ K
"
ÏÏK L
)
ÏÏL M
;
ÏÏM N
}
ÐÐ 
}
ÑÑ 	
}
ÒÒ 
public
ÖÖ 

partial
ÖÖ 
class
ÖÖ 
ManagerController
ÖÖ *
:
ÖÖ+ ,
IUserSession
ÖÖ- 9
{
ÖÖ: ;
public
ÝÝ 
void
ÝÝ 
GetSessionPlayer
ÝÝ $
(
ÝÝ$ %
int
ÝÝ% (
idUser
ÝÝ) /
)
ÝÝ/ 0
{
ÝÝ1 2
try
ÞÞ 
{
ÞÞ "
IUserSessionCallback
ßß $
context
ßß% ,
=
ßß- .
OperationContext
ßß/ ?
.
ßß? @
Current
ßß@ G
.
ßßG H 
GetCallbackChannel
ßßH Z
<
ßßZ ["
IUserSessionCallback
ßß[ o
>
ßßo p
(
ßßp q
)
ßßq r
;
ßßr s
bool
áá 
sessionOpened
áá "
=
áá# $
playerStatus
áá% 1
.
áá1 2
ContainsKey
áá2 =
(
áá= >
idUser
áá> D
)
ááD E
;
ááE F
if
ãã 
(
ãã 
!
ãã 
sessionOpened
ãã "
)
ãã" #
{
ãã$ %
playerStatus
ää  
.
ää  !
Add
ää! $
(
ää$ %
idUser
ää% +
,
ää+ ,
context
ää- 4
)
ää4 5
;
ää5 6"
ICommunicationObject
ææ (!
communicationObject
ææ) <
=
ææ= >
(
ææ? @"
ICommunicationObject
ææ@ T
)
ææT U
context
ææU \
;
ææ\ ]!
communicationObject
çç '
.
çç' (
Closed
çç( .
+=
çç/ 1
(
çç2 3
sender
çç3 9
,
çç9 :
e
çç; <
)
çç< =
=>
çç> @
{
ççA B
RemoveClient
èè $
(
èè$ %
idUser
èè% +
)
èè+ ,
;
èè, -
}
éé 
;
éé !
communicationObject
ëë '
.
ëë' (
Faulted
ëë( /
+=
ëë0 2
(
ëë3 4
sender
ëë4 :
,
ëë: ;
e
ëë< =
)
ëë= >
=>
ëë? A
{
ëëB C
RemoveClient
ìì $
(
ìì$ %
idUser
ìì% +
)
ìì+ ,
;
ìì, -
}
íí 
;
íí 
}
îî 
context
ðð 
.
ðð &
GetSessionPlayerCallback
ðð 0
(
ðð0 1
sessionOpened
ðð1 >
)
ðð> ?
;
ðð? @
}
ññ 
catch
ññ 
(
ññ $
CommunicationException
ññ +
ex
ññ, .
)
ññ. /
{
ññ0 1

MessageBox
òò 
.
òò 
Show
òò 
(
òò  
$"
òò  "
$str
òò" J
{
òòJ K
ex
òòK M
.
òòM N
Message
òòN U
}
òòU V
"
òòV W
)
òòW X
;
òòX Y
}
óó 
}
ôô 	
}
õõ 
}öö Ç
oC:\Users\alexs\Desktop\JuegoTecno (2)\JuegoTecno\ChineseCheckers\ChineseCheckersLogicServer\Model\BoardModel.cs
	namespace		 	&
ChineseCheckersLogicServer		
 $
.		$ %
Model		% *
{		+ ,
[

 
DataContract

 
]

 
public 

class 

BoardModel 
{ 
[ 	

DataMember	 
] 
public 

Dictionary 
< 
string  
,  !
ITurnCallback" /
>/ 0
GamePlayers1 <
{= >
get? B
;B C
setD G
;G H
}I J
=K L
newM P

DictionaryQ [
<[ \
string\ b
,b c
ITurnCallbackd q
>q r
(r s
)s t
;t u
[ 	

DataMember	 
] 
public 
string 
IdRoom 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} ¨
tC:\Users\alexs\Desktop\JuegoTecno (2)\JuegoTecno\ChineseCheckers\ChineseCheckersLogicServer\Model\FriendshipModel.cs
	namespace 	&
ChineseCheckersLogicServer
 $
.$ %
Model% *
{+ ,
[		 
DataContract		 
]		 
public

 

class

 
FriendshipModel

  
{

! "
[ 	

DataMember	 
] 
public 
int 
IdUser 
{ 
get 
;  
set! $
;$ %
}& '
[ 	

DataMember	 
] 
public 
int 
IdFriend 
{ 
get !
;! "
set# &
;& '
}( )
[ 	

DataMember	 
] 
public 
string 
RequestStatus #
{$ %
get& )
;) *
set+ .
;. /
}0 1
[ 	

DataMember	 
] 
public 
string 
TypeNotification &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
[ 	

DataMember	 
] 
public 
string 
IdRoom 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} Ê	
pC:\Users\alexs\Desktop\JuegoTecno (2)\JuegoTecno\ChineseCheckers\ChineseCheckersLogicServer\Model\ReportModel.cs
	namespace 	&
ChineseCheckersLogicServer
 $
.$ %
Model% *
{+ ,
[		 
DataContract		 
]		 
public

 

class

 
ReportModel

 
{

 
[ 	

DataMember	 
] 
public 
int 
IdUser 
{ 
get 
;  
set! $
;$ %
}& '
[ 	

DataMember	 
] 
public 
string 
Reason 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	

DataMember	 
] 
public 
DateTime 
CurrentDate #
{$ %
get& )
;) *
set+ .
;. /
}0 1
[ 	

DataMember	 
] 
public 
DateTime 
EndDate 
{  !
get" %
;% &
set' *
;* +
}, -
} 
} î
nC:\Users\alexs\Desktop\JuegoTecno (2)\JuegoTecno\ChineseCheckers\ChineseCheckersLogicServer\Model\RoomModel.cs
	namespace		 	&
ChineseCheckersLogicServer		
 $
.		$ %
Model		% *
{		+ ,
[

 
DataContract

 
]

 
public 

class 
	RoomModel 
{ 
[ 	

DataMember	 
] 
public 
string 
IdRoom 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	

DataMember	 
] 
public 

Dictionary 
< 
string  
,  !
IMessageCallback" 2
>2 3
Players4 ;
{< =
get> A
;A B
setC F
;F G
}H I
=J K
newL O

DictionaryP Z
<Z [
string[ a
,a b
IMessageCallbackc s
>s t
(t u
)u v
;v w
[ 	

DataMember	 
] 
public 

Dictionary 
< 
string  
,  ! 
IPlayersRoomCallback" 6
>6 7
PlayersRoom8 C
{D E
getF I
;I J
setK N
;N O
}P Q
=R S
newT W

DictionaryX b
<b c
stringc i
,i j 
IPlayersRoomCallbackk 
>	 
(
 
)
 
;
 
public 
char 
[ 
] 
ColorForTwoPlayers (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
=7 8
new9 <
char= A
[A B
]B C
{D E
$charF I
,I J
$charK N
}O P
;P Q
public 
char 
[ 
]  
ColorForThreePlayers *
{+ ,
get- 0
;0 1
set2 5
;5 6
}7 8
=9 :
new; >
char? C
[C D
]D E
{F G
$charH K
,K L
$charM P
,P Q
$charR U
}V W
;W X
public 
char 
[ 
] 
ColorForFourPlayers )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
=8 9
new: =
char> B
[B C
]C D
{E F
$charG J
,J K
$charL O
,O P
$charQ T
,T U
$charV Y
}Z [
;[ \
public 
char 
[ 
] 
ColorForFivePlayers )
{* +
get, /
;/ 0
set1 4
;4 5
}6 7
=8 9
new: =
char> B
[B C
]C D
{E F
$charG J
,J K
$charL O
,O P
$charQ T
,T U
$charV Y
,Y Z
$char[ ^
}_ `
;` a
public 
char 
[ 
] 
ColorForSixPlayers (
{) *
get+ .
;. /
set0 3
;3 4
}5 6
=7 8
new9 <
char= A
[A B
]B C
{D E
$charF I
,I J
$charK N
,N O
$charP S
,S T
$charU X
,X Y
$charZ ]
,] ^
$char_ b
}c d
;d e
} 
} ç
nC:\Users\alexs\Desktop\JuegoTecno (2)\JuegoTecno\ChineseCheckers\ChineseCheckersLogicServer\Model\UserModel.cs
	namespace		 	&
ChineseCheckersLogicServer		
 $
.		$ %
Model		% *
{		+ ,
[

 
DataContract

 
]

 
public 

class 
	UserModel 
{ 
[ 	

DataMember	 
] 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
[ 	

DataMember	 
] 
public 
string 
Gamertag 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	

DataMember	 
] 
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
[ 	

DataMember	 
] 
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 	

DataMember	 
] 
public 
string 
ImageProfile "
{# $
get% (
;( )
set* -
;- .
}/ 0
[ 	

DataMember	 
] 
public 
string 
PlayerStatus "
{# $
get% (
;( )
set* -
;- .
}/ 0
} 
} ¡
vC:\Users\alexs\Desktop\JuegoTecno (2)\JuegoTecno\ChineseCheckers\ChineseCheckersLogicServer\Properties\AssemblyInfo.cs
[ 
assembly 	
:	 

AssemblyTitle 
( 
$str 5
)5 6
]6 7
[		 
assembly		 	
:			 

AssemblyDescription		 
(		 
$str		 !
)		! "
]		" #
[

 
assembly

 	
:

	 
!
AssemblyConfiguration

  
(

  !
$str

! #
)

# $
]

$ %
[ 
assembly 	
:	 

AssemblyCompany 
( 
$str 
) 
] 
[ 
assembly 	
:	 

AssemblyProduct 
( 
$str 7
)7 8
]8 9
[ 
assembly 	
:	 

AssemblyCopyright 
( 
$str 0
)0 1
]1 2
[ 
assembly 	
:	 

AssemblyTrademark 
( 
$str 
)  
]  !
[ 
assembly 	
:	 

AssemblyCulture 
( 
$str 
) 
] 
[ 
assembly 	
:	 


ComVisible 
( 
false 
) 
] 
[ 
assembly 	
:	 

Guid 
( 
$str 6
)6 7
]7 8
[## 
assembly## 	
:##	 

AssemblyVersion## 
(## 
$str## $
)##$ %
]##% &
[$$ 
assembly$$ 	
:$$	 

AssemblyFileVersion$$ 
($$ 
$str$$ (
)$$( )
]$$) *